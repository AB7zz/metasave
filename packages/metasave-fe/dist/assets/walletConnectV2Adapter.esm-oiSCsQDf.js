import{ad as kt,at as j,u as Ze,au as nn,av as ar,aw as cr,ae as vt,G as on,ax as ht,ay as an,az as cn,aA as un,aB as P,aC as ln,aD as Pi,aE as hn,aF as fn,aG as dn,aH as ss,aI as pn,aJ as gn,aK as yn,aL as rs,aM as Dn,aN as bn,aO as zt,aP as ns,aQ as mn,aR as wn,aS as ur,aT as lr,aU as We,aV as vn,aW as os,aX as Et,aY as ie,aZ as Re,a_ as lt,a$ as qe,b0 as En,b1 as _t,b2 as hr,b3 as _n,b4 as xn,b5 as Sn,b6 as fr,b7 as In,b8 as dr,b9 as pr,ba as Cn,bb as St,bc as Oi,bd as Zt,be as gr,bf as Pn,bg as hi,bh as On,bi as Rn,bj as An,bk as Tn,bl as Jt,bm as Nn,bn as $n,bo as fi,bp as as,bq as Ln,br as Mn,bs as jn,bt as cs,bu as zn,bv as qn,bw as Un,bx as Fn,by as kn,bz as Bn,bA as Vn,C as at,a as Qe,W as Ot,A as Kn,h as Hn,i as Fe,b as di,n as tt,m as Gn,bB as us,k as ut,j as He,o as Wn,q as pi,bC as ls}from"./index-pF3uMl6W.js";import{B as Jn}from"./baseEvmAdapter.esm-wvtJKo_M.js";const Yn=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,Qn=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,Xn=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function Zn(i,e){if(i==="__proto__"||i==="constructor"&&e&&typeof e=="object"&&"prototype"in e){eo(i);return}return e}function eo(i){console.warn(`[destr] Dropping "${i}" key to prevent prototype pollution.`)}function Yt(i,e={}){if(typeof i!="string")return i;const t=i.trim();if(i[0]==='"'&&i.at(-1)==='"'&&!i.includes("\\"))return t.slice(1,-1);if(t.length<=9){const s=t.toLowerCase();if(s==="true")return!0;if(s==="false")return!1;if(s==="undefined")return;if(s==="null")return null;if(s==="nan")return Number.NaN;if(s==="infinity")return Number.POSITIVE_INFINITY;if(s==="-infinity")return Number.NEGATIVE_INFINITY}if(!Xn.test(i)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return i}try{if(Yn.test(i)||Qn.test(i)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(i,Zn)}return JSON.parse(i)}catch(s){if(e.strict)throw s;return i}}function to(i){return!i||typeof i.then!="function"?Promise.resolve(i):i}function oe(i,...e){try{return to(i(...e))}catch(t){return Promise.reject(t)}}function io(i){const e=typeof i;return i===null||e!=="object"&&e!=="function"}function so(i){const e=Object.getPrototypeOf(i);return!e||e.isPrototypeOf(Object)}function ei(i){if(io(i))return String(i);if(so(i)||Array.isArray(i))return JSON.stringify(i);if(typeof i.toJSON=="function")return ei(i.toJSON());throw new Error("[unstorage] Cannot stringify value!")}function yr(){if(typeof Buffer===void 0)throw new TypeError("[unstorage] Buffer is not supported!")}const Ri="base64:";function ro(i){if(typeof i=="string")return i;yr();const e=Buffer.from(i).toString("base64");return Ri+e}function no(i){return typeof i!="string"||!i.startsWith(Ri)?i:(yr(),Buffer.from(i.slice(Ri.length),"base64"))}function ze(i){return i?i.split("?")[0].replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""):""}function oo(...i){return ze(i.join(":"))}function Qt(i){return i=ze(i),i?i+":":""}const ao="memory",co=()=>{const i=new Map;return{name:ao,options:{},hasItem(e){return i.has(e)},getItem(e){return i.get(e)??null},getItemRaw(e){return i.get(e)??null},setItem(e,t){i.set(e,t)},setItemRaw(e,t){i.set(e,t)},removeItem(e){i.delete(e)},getKeys(){return Array.from(i.keys())},clear(){i.clear()},dispose(){i.clear()}}};function uo(i={}){const e={mounts:{"":i.driver||co()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},t=c=>{for(const h of e.mountpoints)if(c.startsWith(h))return{base:h,relativeKey:c.slice(h.length),driver:e.mounts[h]};return{base:"",relativeKey:c,driver:e.mounts[""]}},s=(c,h)=>e.mountpoints.filter(g=>g.startsWith(c)||h&&c.startsWith(g)).map(g=>({relativeBase:c.length>g.length?c.slice(g.length):void 0,mountpoint:g,driver:e.mounts[g]})),r=(c,h)=>{if(e.watching){h=ze(h);for(const g of e.watchListeners)g(c,h)}},n=async()=>{if(!e.watching){e.watching=!0;for(const c in e.mounts)e.unwatch[c]=await hs(e.mounts[c],r,c)}},a=async()=>{if(e.watching){for(const c in e.unwatch)await e.unwatch[c]();e.unwatch={},e.watching=!1}},u=(c,h,g)=>{const d=new Map,v=p=>{let _=d.get(p.base);return _||(_={driver:p.driver,base:p.base,items:[]},d.set(p.base,_)),_};for(const p of c){const _=typeof p=="string",$=ze(_?p:p.key),A=_?void 0:p.value,N=_||!p.options?h:{...h,...p.options},L=t($);v(L).items.push({key:$,value:A,relativeKey:L.relativeKey,options:N})}return Promise.all([...d.values()].map(p=>g(p))).then(p=>p.flat())},l={hasItem(c,h={}){c=ze(c);const{relativeKey:g,driver:d}=t(c);return oe(d.hasItem,g,h)},getItem(c,h={}){c=ze(c);const{relativeKey:g,driver:d}=t(c);return oe(d.getItem,g,h).then(v=>Yt(v))},getItems(c,h){return u(c,h,g=>g.driver.getItems?oe(g.driver.getItems,g.items.map(d=>({key:d.relativeKey,options:d.options})),h).then(d=>d.map(v=>({key:oo(g.base,v.key),value:Yt(v.value)}))):Promise.all(g.items.map(d=>oe(g.driver.getItem,d.relativeKey,d.options).then(v=>({key:d.key,value:Yt(v)})))))},getItemRaw(c,h={}){c=ze(c);const{relativeKey:g,driver:d}=t(c);return d.getItemRaw?oe(d.getItemRaw,g,h):oe(d.getItem,g,h).then(v=>no(v))},async setItem(c,h,g={}){if(h===void 0)return l.removeItem(c);c=ze(c);const{relativeKey:d,driver:v}=t(c);v.setItem&&(await oe(v.setItem,d,ei(h),g),v.watch||r("update",c))},async setItems(c,h){await u(c,h,async g=>{g.driver.setItems&&await oe(g.driver.setItems,g.items.map(d=>({key:d.relativeKey,value:ei(d.value),options:d.options})),h),g.driver.setItem&&await Promise.all(g.items.map(d=>oe(g.driver.setItem,d.relativeKey,ei(d.value),d.options)))})},async setItemRaw(c,h,g={}){if(h===void 0)return l.removeItem(c,g);c=ze(c);const{relativeKey:d,driver:v}=t(c);if(v.setItemRaw)await oe(v.setItemRaw,d,h,g);else if(v.setItem)await oe(v.setItem,d,ro(h),g);else return;v.watch||r("update",c)},async removeItem(c,h={}){typeof h=="boolean"&&(h={removeMeta:h}),c=ze(c);const{relativeKey:g,driver:d}=t(c);d.removeItem&&(await oe(d.removeItem,g,h),(h.removeMeta||h.removeMata)&&await oe(d.removeItem,g+"$",h),d.watch||r("remove",c))},async getMeta(c,h={}){typeof h=="boolean"&&(h={nativeOnly:h}),c=ze(c);const{relativeKey:g,driver:d}=t(c),v=Object.create(null);if(d.getMeta&&Object.assign(v,await oe(d.getMeta,g,h)),!h.nativeOnly){const p=await oe(d.getItem,g+"$",h).then(_=>Yt(_));p&&typeof p=="object"&&(typeof p.atime=="string"&&(p.atime=new Date(p.atime)),typeof p.mtime=="string"&&(p.mtime=new Date(p.mtime)),Object.assign(v,p))}return v},setMeta(c,h,g={}){return this.setItem(c+"$",h,g)},removeMeta(c,h={}){return this.removeItem(c+"$",h)},async getKeys(c,h={}){c=Qt(c);const g=s(c,!0);let d=[];const v=[];for(const p of g){const $=(await oe(p.driver.getKeys,p.relativeBase,h)).map(A=>p.mountpoint+ze(A)).filter(A=>!d.some(N=>A.startsWith(N)));v.push(...$),d=[p.mountpoint,...d.filter(A=>!A.startsWith(p.mountpoint))]}return c?v.filter(p=>p.startsWith(c)&&!p.endsWith("$")):v.filter(p=>!p.endsWith("$"))},async clear(c,h={}){c=Qt(c),await Promise.all(s(c,!1).map(async g=>{if(g.driver.clear)return oe(g.driver.clear,g.relativeBase,h);if(g.driver.removeItem){const d=await g.driver.getKeys(g.relativeBase||"",h);return Promise.all(d.map(v=>g.driver.removeItem(v,h)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(c=>fs(c)))},async watch(c){return await n(),e.watchListeners.push(c),async()=>{e.watchListeners=e.watchListeners.filter(h=>h!==c),e.watchListeners.length===0&&await a()}},async unwatch(){e.watchListeners=[],await a()},mount(c,h){if(c=Qt(c),c&&e.mounts[c])throw new Error(`already mounted at ${c}`);return c&&(e.mountpoints.push(c),e.mountpoints.sort((g,d)=>d.length-g.length)),e.mounts[c]=h,e.watching&&Promise.resolve(hs(h,r,c)).then(g=>{e.unwatch[c]=g}).catch(console.error),l},async unmount(c,h=!0){c=Qt(c),!(!c||!e.mounts[c])&&(e.watching&&c in e.unwatch&&(e.unwatch[c](),delete e.unwatch[c]),h&&await fs(e.mounts[c]),e.mountpoints=e.mountpoints.filter(g=>g!==c),delete e.mounts[c])},getMount(c=""){c=ze(c)+":";const h=t(c);return{driver:h.driver,base:h.base}},getMounts(c="",h={}){return c=ze(c),s(c,h.parents).map(d=>({driver:d.driver,base:d.mountpoint}))}};return l}function hs(i,e,t){return i.watch?i.watch((s,r)=>e(s,t+r)):()=>{}}async function fs(i){typeof i.dispose=="function"&&await oe(i.dispose)}function yt(i){return new Promise((e,t)=>{i.oncomplete=i.onsuccess=()=>e(i.result),i.onabort=i.onerror=()=>t(i.error)})}function Dr(i,e){const t=indexedDB.open(i);t.onupgradeneeded=()=>t.result.createObjectStore(e);const s=yt(t);return(r,n)=>s.then(a=>n(a.transaction(e,r).objectStore(e)))}let gi;function Bt(){return gi||(gi=Dr("keyval-store","keyval")),gi}function ds(i,e=Bt()){return e("readonly",t=>yt(t.get(i)))}function lo(i,e,t=Bt()){return t("readwrite",s=>(s.put(e,i),yt(s.transaction)))}function ho(i,e=Bt()){return e("readwrite",t=>(t.delete(i),yt(t.transaction)))}function fo(i=Bt()){return i("readwrite",e=>(e.clear(),yt(e.transaction)))}function po(i,e){return i.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},yt(i.transaction)}function go(i=Bt()){return i("readonly",e=>{if(e.getAllKeys)return yt(e.getAllKeys());const t=[];return po(e,s=>t.push(s.key)).then(()=>t)})}const yo=i=>JSON.stringify(i,(e,t)=>typeof t=="bigint"?t.toString()+"n":t),Do=i=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,t=i.replace(e,'$1"$2n"$3');return JSON.parse(t,(s,r)=>typeof r=="string"&&r.match(/^\d+n$/)?BigInt(r.substring(0,r.length-1)):r)};function si(i){if(typeof i!="string")throw new Error(`Cannot safe json parse value of type ${typeof i}`);try{return Do(i)}catch{return i}}function Vt(i){return typeof i=="string"?i:yo(i)||""}const bo="idb-keyval";var mo=(i={})=>{const e=i.base&&i.base.length>0?`${i.base}:`:"",t=r=>e+r;let s;return i.dbName&&i.storeName&&(s=Dr(i.dbName,i.storeName)),{name:bo,options:i,async hasItem(r){return!(typeof await ds(t(r),s)>"u")},async getItem(r){return await ds(t(r),s)??null},setItem(r,n){return lo(t(r),n,s)},removeItem(r){return ho(t(r),s)},getKeys(){return go(s)},clear(){return fo(s)}}};const wo="WALLET_CONNECT_V2_INDEXED_DB",vo="keyvaluestorage";class Eo{constructor(){this.indexedDb=uo({driver:mo({dbName:wo,storeName:vo})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const t=await this.indexedDb.getItem(e);if(t!==null)return t}async setItem(e,t){await this.indexedDb.setItem(e,Vt(t))}async removeItem(e){await this.indexedDb.removeItem(e)}}var yi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ti={exports:{}};(function(){let i;function e(){}i=e,i.prototype.getItem=function(t){return this.hasOwnProperty(t)?String(this[t]):null},i.prototype.setItem=function(t,s){this[t]=String(s)},i.prototype.removeItem=function(t){delete this[t]},i.prototype.clear=function(){const t=this;Object.keys(t).forEach(function(s){t[s]=void 0,delete t[s]})},i.prototype.key=function(t){return t=t||0,Object.keys(this)[t]},i.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof yi<"u"&&yi.localStorage?ti.exports=yi.localStorage:typeof window<"u"&&window.localStorage?ti.exports=window.localStorage:ti.exports=new e})();function _o(i){var e;return[i[0],si((e=i[1])!=null?e:"")]}class xo{constructor(){this.localStorage=ti.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(_o)}async getItem(e){const t=this.localStorage.getItem(e);if(t!==null)return si(t)}async setItem(e,t){this.localStorage.setItem(e,Vt(t))}async removeItem(e){this.localStorage.removeItem(e)}}const So="wc_storage_version",ps=1,Io=async(i,e,t)=>{const s=So,r=await e.getItem(s);if(r&&r>=ps){t(e);return}const n=await i.getKeys();if(!n.length){t(e);return}const a=[];for(;n.length;){const u=n.shift();if(!u)continue;const l=u.toLowerCase();if(l.includes("wc@")||l.includes("walletconnect")||l.includes("wc_")||l.includes("wallet_connect")){const c=await i.getItem(u);await e.setItem(u,c),a.push(u)}}await e.setItem(s,ps),t(e),Co(i,a)},Co=async(i,e)=>{e.length&&e.forEach(async t=>{await i.removeItem(t)})};let Po=class{constructor(){this.initialized=!1,this.setInitialized=t=>{this.storage=t,this.initialized=!0};const e=new xo;this.storage=e;try{const t=new Eo;Io(e,t,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,t){return await this.initialize(),this.storage.setItem(e,t)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const t=setInterval(()=>{this.initialized&&(clearInterval(t),e())},20)})}};var Ct={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Ai=function(i,e){return Ai=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,s){t.__proto__=s}||function(t,s){for(var r in s)s.hasOwnProperty(r)&&(t[r]=s[r])},Ai(i,e)};function Oo(i,e){Ai(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var Ti=function(){return Ti=Object.assign||function(e){for(var t,s=1,r=arguments.length;s<r;s++){t=arguments[s];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},Ti.apply(this,arguments)};function Ro(i,e){var t={};for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&e.indexOf(s)<0&&(t[s]=i[s]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(i);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(i,s[r])&&(t[s[r]]=i[s[r]]);return t}function Ao(i,e,t,s){var r=arguments.length,n=r<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(i,e,t,s);else for(var u=i.length-1;u>=0;u--)(a=i[u])&&(n=(r<3?a(n):r>3?a(e,t,n):a(e,t))||n);return r>3&&n&&Object.defineProperty(e,t,n),n}function To(i,e){return function(t,s){e(t,s,i)}}function No(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)}function $o(i,e,t,s){function r(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function u(h){try{c(s.next(h))}catch(g){a(g)}}function l(h){try{c(s.throw(h))}catch(g){a(g)}}function c(h){h.done?n(h.value):r(h.value).then(u,l)}c((s=s.apply(i,e||[])).next())})}function Lo(i,e){var t={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},s,r,n,a;return a={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(c){return function(h){return l([c,h])}}function l(c){if(s)throw new TypeError("Generator is already executing.");for(;t;)try{if(s=1,r&&(n=c[0]&2?r.return:c[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,c[1])).done)return n;switch(r=0,n&&(c=[c[0]&2,n.value]),c[0]){case 0:case 1:n=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,r=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(n=t.trys,!(n=n.length>0&&n[n.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!n||c[1]>n[0]&&c[1]<n[3])){t.label=c[1];break}if(c[0]===6&&t.label<n[1]){t.label=n[1],n=c;break}if(n&&t.label<n[2]){t.label=n[2],t.ops.push(c);break}n[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(i,t)}catch(h){c=[6,h],r=0}finally{s=n=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function Mo(i,e,t,s){s===void 0&&(s=t),i[s]=e[t]}function jo(i,e){for(var t in i)t!=="default"&&!e.hasOwnProperty(t)&&(e[t]=i[t])}function Ni(i){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&i[e],s=0;if(t)return t.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&s>=i.length&&(i=void 0),{value:i&&i[s++],done:!i}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function br(i,e){var t=typeof Symbol=="function"&&i[Symbol.iterator];if(!t)return i;var s=t.call(i),r,n=[],a;try{for(;(e===void 0||e-- >0)&&!(r=s.next()).done;)n.push(r.value)}catch(u){a={error:u}}finally{try{r&&!r.done&&(t=s.return)&&t.call(s)}finally{if(a)throw a.error}}return n}function zo(){for(var i=[],e=0;e<arguments.length;e++)i=i.concat(br(arguments[e]));return i}function qo(){for(var i=0,e=0,t=arguments.length;e<t;e++)i+=arguments[e].length;for(var s=Array(i),r=0,e=0;e<t;e++)for(var n=arguments[e],a=0,u=n.length;a<u;a++,r++)s[r]=n[a];return s}function qt(i){return this instanceof qt?(this.v=i,this):new qt(i)}function Uo(i,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=t.apply(i,e||[]),r,n=[];return r={},a("next"),a("throw"),a("return"),r[Symbol.asyncIterator]=function(){return this},r;function a(d){s[d]&&(r[d]=function(v){return new Promise(function(p,_){n.push([d,v,p,_])>1||u(d,v)})})}function u(d,v){try{l(s[d](v))}catch(p){g(n[0][3],p)}}function l(d){d.value instanceof qt?Promise.resolve(d.value.v).then(c,h):g(n[0][2],d)}function c(d){u("next",d)}function h(d){u("throw",d)}function g(d,v){d(v),n.shift(),n.length&&u(n[0][0],n[0][1])}}function Fo(i){var e,t;return e={},s("next"),s("throw",function(r){throw r}),s("return"),e[Symbol.iterator]=function(){return this},e;function s(r,n){e[r]=i[r]?function(a){return(t=!t)?{value:qt(i[r](a)),done:r==="return"}:n?n(a):a}:n}}function ko(i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=i[Symbol.asyncIterator],t;return e?e.call(i):(i=typeof Ni=="function"?Ni(i):i[Symbol.iterator](),t={},s("next"),s("throw"),s("return"),t[Symbol.asyncIterator]=function(){return this},t);function s(n){t[n]=i[n]&&function(a){return new Promise(function(u,l){a=i[n](a),r(u,l,a.done,a.value)})}}function r(n,a,u,l){Promise.resolve(l).then(function(c){n({value:c,done:u})},a)}}function Bo(i,e){return Object.defineProperty?Object.defineProperty(i,"raw",{value:e}):i.raw=e,i}function Vo(i){if(i&&i.__esModule)return i;var e={};if(i!=null)for(var t in i)Object.hasOwnProperty.call(i,t)&&(e[t]=i[t]);return e.default=i,e}function Ko(i){return i&&i.__esModule?i:{default:i}}function Ho(i,e){if(!e.has(i))throw new TypeError("attempted to get private field on non-instance");return e.get(i)}function Go(i,e,t){if(!e.has(i))throw new TypeError("attempted to set private field on non-instance");return e.set(i,t),t}const Wo=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Ti},__asyncDelegator:Fo,__asyncGenerator:Uo,__asyncValues:ko,__await:qt,__awaiter:$o,__classPrivateFieldGet:Ho,__classPrivateFieldSet:Go,__createBinding:Mo,__decorate:Ao,__exportStar:jo,__extends:Oo,__generator:Lo,__importDefault:Ko,__importStar:Vo,__makeTemplateObject:Bo,__metadata:No,__param:To,__read:br,__rest:Ro,__spread:zo,__spreadArrays:qo,__values:Ni},Symbol.toStringTag,{value:"Module"})),ri=kt(Wo);var Rt={},Di={},At={};let Dt=class{};const Jo=Object.freeze(Object.defineProperty({__proto__:null,IEvents:Dt},Symbol.toStringTag,{value:"Module"})),Yo=kt(Jo);var gs;function Qo(){if(gs)return At;gs=1,Object.defineProperty(At,"__esModule",{value:!0}),At.IHeartBeat=void 0;const i=Yo;class e extends i.IEvents{constructor(s){super()}}return At.IHeartBeat=e,At}var ys;function mr(){return ys||(ys=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),ri.__exportStar(Qo(),i)}(Di)),Di}var bi={},pt={},Ds;function Xo(){if(Ds)return pt;Ds=1,Object.defineProperty(pt,"__esModule",{value:!0}),pt.HEARTBEAT_EVENTS=pt.HEARTBEAT_INTERVAL=void 0;const i=j;return pt.HEARTBEAT_INTERVAL=i.FIVE_SECONDS,pt.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},pt}var bs;function wr(){return bs||(bs=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),ri.__exportStar(Xo(),i)}(bi)),bi}var ms;function Zo(){if(ms)return Rt;ms=1,Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.HeartBeat=void 0;const i=ri,e=Ze,t=j,s=mr(),r=wr();class n extends s.IHeartBeat{constructor(u){super(u),this.events=new e.EventEmitter,this.interval=r.HEARTBEAT_INTERVAL,this.interval=(u==null?void 0:u.interval)||r.HEARTBEAT_INTERVAL}static init(u){return i.__awaiter(this,void 0,void 0,function*(){const l=new n(u);return yield l.init(),l})}init(){return i.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(u,l){this.events.on(u,l)}once(u,l){this.events.once(u,l)}off(u,l){this.events.off(u,l)}removeListener(u,l){this.events.removeListener(u,l)}initialize(){return i.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),t.toMiliseconds(this.interval))})}pulse(){this.events.emit(r.HEARTBEAT_EVENTS.pulse)}}return Rt.HeartBeat=n,Rt}(function(i){Object.defineProperty(i,"__esModule",{value:!0});const e=ri;e.__exportStar(Zo(),i),e.__exportStar(mr(),i),e.__exportStar(wr(),i)})(Ct);var k={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var $i=function(i,e){return $i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,s){t.__proto__=s}||function(t,s){for(var r in s)s.hasOwnProperty(r)&&(t[r]=s[r])},$i(i,e)};function ea(i,e){$i(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var Li=function(){return Li=Object.assign||function(e){for(var t,s=1,r=arguments.length;s<r;s++){t=arguments[s];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},Li.apply(this,arguments)};function ta(i,e){var t={};for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&e.indexOf(s)<0&&(t[s]=i[s]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(i);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(i,s[r])&&(t[s[r]]=i[s[r]]);return t}function ia(i,e,t,s){var r=arguments.length,n=r<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(i,e,t,s);else for(var u=i.length-1;u>=0;u--)(a=i[u])&&(n=(r<3?a(n):r>3?a(e,t,n):a(e,t))||n);return r>3&&n&&Object.defineProperty(e,t,n),n}function sa(i,e){return function(t,s){e(t,s,i)}}function ra(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)}function na(i,e,t,s){function r(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function u(h){try{c(s.next(h))}catch(g){a(g)}}function l(h){try{c(s.throw(h))}catch(g){a(g)}}function c(h){h.done?n(h.value):r(h.value).then(u,l)}c((s=s.apply(i,e||[])).next())})}function oa(i,e){var t={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},s,r,n,a;return a={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(c){return function(h){return l([c,h])}}function l(c){if(s)throw new TypeError("Generator is already executing.");for(;t;)try{if(s=1,r&&(n=c[0]&2?r.return:c[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,c[1])).done)return n;switch(r=0,n&&(c=[c[0]&2,n.value]),c[0]){case 0:case 1:n=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,r=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(n=t.trys,!(n=n.length>0&&n[n.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!n||c[1]>n[0]&&c[1]<n[3])){t.label=c[1];break}if(c[0]===6&&t.label<n[1]){t.label=n[1],n=c;break}if(n&&t.label<n[2]){t.label=n[2],t.ops.push(c);break}n[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(i,t)}catch(h){c=[6,h],r=0}finally{s=n=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function aa(i,e,t,s){s===void 0&&(s=t),i[s]=e[t]}function ca(i,e){for(var t in i)t!=="default"&&!e.hasOwnProperty(t)&&(e[t]=i[t])}function Mi(i){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&i[e],s=0;if(t)return t.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&s>=i.length&&(i=void 0),{value:i&&i[s++],done:!i}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function vr(i,e){var t=typeof Symbol=="function"&&i[Symbol.iterator];if(!t)return i;var s=t.call(i),r,n=[],a;try{for(;(e===void 0||e-- >0)&&!(r=s.next()).done;)n.push(r.value)}catch(u){a={error:u}}finally{try{r&&!r.done&&(t=s.return)&&t.call(s)}finally{if(a)throw a.error}}return n}function ua(){for(var i=[],e=0;e<arguments.length;e++)i=i.concat(vr(arguments[e]));return i}function la(){for(var i=0,e=0,t=arguments.length;e<t;e++)i+=arguments[e].length;for(var s=Array(i),r=0,e=0;e<t;e++)for(var n=arguments[e],a=0,u=n.length;a<u;a++,r++)s[r]=n[a];return s}function Ut(i){return this instanceof Ut?(this.v=i,this):new Ut(i)}function ha(i,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=t.apply(i,e||[]),r,n=[];return r={},a("next"),a("throw"),a("return"),r[Symbol.asyncIterator]=function(){return this},r;function a(d){s[d]&&(r[d]=function(v){return new Promise(function(p,_){n.push([d,v,p,_])>1||u(d,v)})})}function u(d,v){try{l(s[d](v))}catch(p){g(n[0][3],p)}}function l(d){d.value instanceof Ut?Promise.resolve(d.value.v).then(c,h):g(n[0][2],d)}function c(d){u("next",d)}function h(d){u("throw",d)}function g(d,v){d(v),n.shift(),n.length&&u(n[0][0],n[0][1])}}function fa(i){var e,t;return e={},s("next"),s("throw",function(r){throw r}),s("return"),e[Symbol.iterator]=function(){return this},e;function s(r,n){e[r]=i[r]?function(a){return(t=!t)?{value:Ut(i[r](a)),done:r==="return"}:n?n(a):a}:n}}function da(i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=i[Symbol.asyncIterator],t;return e?e.call(i):(i=typeof Mi=="function"?Mi(i):i[Symbol.iterator](),t={},s("next"),s("throw"),s("return"),t[Symbol.asyncIterator]=function(){return this},t);function s(n){t[n]=i[n]&&function(a){return new Promise(function(u,l){a=i[n](a),r(u,l,a.done,a.value)})}}function r(n,a,u,l){Promise.resolve(l).then(function(c){n({value:c,done:u})},a)}}function pa(i,e){return Object.defineProperty?Object.defineProperty(i,"raw",{value:e}):i.raw=e,i}function ga(i){if(i&&i.__esModule)return i;var e={};if(i!=null)for(var t in i)Object.hasOwnProperty.call(i,t)&&(e[t]=i[t]);return e.default=i,e}function ya(i){return i&&i.__esModule?i:{default:i}}function Da(i,e){if(!e.has(i))throw new TypeError("attempted to get private field on non-instance");return e.get(i)}function ba(i,e,t){if(!e.has(i))throw new TypeError("attempted to set private field on non-instance");return e.set(i,t),t}const ma=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Li},__asyncDelegator:fa,__asyncGenerator:ha,__asyncValues:da,__await:Ut,__awaiter:na,__classPrivateFieldGet:Da,__classPrivateFieldSet:ba,__createBinding:aa,__decorate:ia,__exportStar:ca,__extends:ea,__generator:oa,__importDefault:ya,__importStar:ga,__makeTemplateObject:pa,__metadata:ra,__param:sa,__read:vr,__rest:ta,__spread:ua,__spreadArrays:la,__values:Mi},Symbol.toStringTag,{value:"Module"})),wa=kt(ma);var mi,ws;function va(){if(ws)return mi;ws=1;function i(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}mi=e;function e(t,s,r){var n=r&&r.stringify||i,a=1;if(typeof t=="object"&&t!==null){var u=s.length+a;if(u===1)return t;var l=new Array(u);l[0]=n(t);for(var c=1;c<u;c++)l[c]=n(s[c]);return l.join(" ")}if(typeof t!="string")return t;var h=s.length;if(h===0)return t;for(var g="",d=1-a,v=-1,p=t&&t.length||0,_=0;_<p;){if(t.charCodeAt(_)===37&&_+1<p){switch(v=v>-1?v:0,t.charCodeAt(_+1)){case 100:case 102:if(d>=h||s[d]==null)break;v<_&&(g+=t.slice(v,_)),g+=Number(s[d]),v=_+2,_++;break;case 105:if(d>=h||s[d]==null)break;v<_&&(g+=t.slice(v,_)),g+=Math.floor(Number(s[d])),v=_+2,_++;break;case 79:case 111:case 106:if(d>=h||s[d]===void 0)break;v<_&&(g+=t.slice(v,_));var $=typeof s[d];if($==="string"){g+="'"+s[d]+"'",v=_+2,_++;break}if($==="function"){g+=s[d].name||"<anonymous>",v=_+2,_++;break}g+=n(s[d]),v=_+2,_++;break;case 115:if(d>=h)break;v<_&&(g+=t.slice(v,_)),g+=String(s[d]),v=_+2,_++;break;case 37:v<_&&(g+=t.slice(v,_)),g+="%",v=_+2,_++,d--;break}++d}++_}return v===-1?t:(v<p&&(g+=t.slice(v)),g)}return mi}var wi,vs;function Ea(){if(vs)return wi;vs=1;const i=va();wi=r;const e=z().console||{},t={mapHttpRequest:p,mapHttpResponse:p,wrapRequestSerializer:_,wrapResponseSerializer:_,wrapErrorSerializer:_,req:p,res:p,err:d};function s(b,E){return Array.isArray(b)?b.filter(function(U){return U!=="!stdSerializers.err"}):b===!0?Object.keys(E):!1}function r(b){b=b||{},b.browser=b.browser||{};const E=b.browser.transmit;if(E&&typeof E.send!="function")throw Error("pino: transmit option must have a send function");const I=b.browser.write||e;b.browser.write&&(b.browser.asObject=!0);const U=b.serializers||{},q=s(b.browser.serialize,U);let B=b.browser.serialize;Array.isArray(b.browser.serialize)&&b.browser.serialize.indexOf("!stdSerializers.err")>-1&&(B=!1);const K=["error","fatal","warn","info","debug","trace"];typeof I=="function"&&(I.error=I.fatal=I.warn=I.info=I.debug=I.trace=I),b.enabled===!1&&(b.level="silent");const ee=b.level||"info",D=Object.create(I);D.log||(D.log=$),Object.defineProperty(D,"levelVal",{get:G}),Object.defineProperty(D,"level",{get:Q,set:T});const x={transmit:E,serialize:q,asObject:b.browser.asObject,levels:K,timestamp:v(b)};D.levels=r.levels,D.level=ee,D.setMaxListeners=D.getMaxListeners=D.emit=D.addListener=D.on=D.prependListener=D.once=D.prependOnceListener=D.removeListener=D.removeAllListeners=D.listeners=D.listenerCount=D.eventNames=D.write=D.flush=$,D.serializers=U,D._serialize=q,D._stdErrSerialize=B,D.child=C,E&&(D._logEvent=g());function G(){return this.level==="silent"?1/0:this.levels.values[this.level]}function Q(){return this._level}function T(S){if(S!=="silent"&&!this.levels.values[S])throw Error("unknown level "+S);this._level=S,n(x,D,"error","log"),n(x,D,"fatal","error"),n(x,D,"warn","error"),n(x,D,"info","log"),n(x,D,"debug","log"),n(x,D,"trace","log")}function C(S,O){if(!S)throw new Error("missing bindings for child Pino");O=O||{},q&&S.serializers&&(O.serializers=S.serializers);const re=O.serializers;if(q&&re){var Y=Object.assign({},U,re),bt=b.browser.serialize===!0?Object.keys(Y):q;delete S.serializers,l([S],bt,Y,this._stdErrSerialize)}function mt(ke){this._childLevel=(ke._childLevel|0)+1,this.error=c(ke,S,"error"),this.fatal=c(ke,S,"fatal"),this.warn=c(ke,S,"warn"),this.info=c(ke,S,"info"),this.debug=c(ke,S,"debug"),this.trace=c(ke,S,"trace"),Y&&(this.serializers=Y,this._serialize=bt),E&&(this._logEvent=g([].concat(ke._logEvent.bindings,S)))}return mt.prototype=this,new mt(this)}return D}r.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},r.stdSerializers=t,r.stdTimeFunctions=Object.assign({},{nullTime:A,epochTime:N,unixTime:L,isoTime:R});function n(b,E,I,U){const q=Object.getPrototypeOf(E);E[I]=E.levelVal>E.levels.values[I]?$:q[I]?q[I]:e[I]||e[U]||$,a(b,E,I)}function a(b,E,I){!b.transmit&&E[I]===$||(E[I]=function(U){return function(){const B=b.timestamp(),K=new Array(arguments.length),ee=Object.getPrototypeOf&&Object.getPrototypeOf(this)===e?e:this;for(var D=0;D<K.length;D++)K[D]=arguments[D];if(b.serialize&&!b.asObject&&l(K,this._serialize,this.serializers,this._stdErrSerialize),b.asObject?U.call(ee,u(this,I,K,B)):U.apply(ee,K),b.transmit){const x=b.transmit.level||E.level,G=r.levels.values[x],Q=r.levels.values[I];if(Q<G)return;h(this,{ts:B,methodLevel:I,methodValue:Q,transmitLevel:x,transmitValue:r.levels.values[b.transmit.level||E.level],send:b.transmit.send,val:E.levelVal},K)}}}(E[I]))}function u(b,E,I,U){b._serialize&&l(I,b._serialize,b.serializers,b._stdErrSerialize);const q=I.slice();let B=q[0];const K={};U&&(K.time=U),K.level=r.levels.values[E];let ee=(b._childLevel|0)+1;if(ee<1&&(ee=1),B!==null&&typeof B=="object"){for(;ee--&&typeof q[0]=="object";)Object.assign(K,q.shift());B=q.length?i(q.shift(),q):void 0}else typeof B=="string"&&(B=i(q.shift(),q));return B!==void 0&&(K.msg=B),K}function l(b,E,I,U){for(const q in b)if(U&&b[q]instanceof Error)b[q]=r.stdSerializers.err(b[q]);else if(typeof b[q]=="object"&&!Array.isArray(b[q]))for(const B in b[q])E&&E.indexOf(B)>-1&&B in I&&(b[q][B]=I[B](b[q][B]))}function c(b,E,I){return function(){const U=new Array(1+arguments.length);U[0]=E;for(var q=1;q<U.length;q++)U[q]=arguments[q-1];return b[I].apply(this,U)}}function h(b,E,I){const U=E.send,q=E.ts,B=E.methodLevel,K=E.methodValue,ee=E.val,D=b._logEvent.bindings;l(I,b._serialize||Object.keys(b.serializers),b.serializers,b._stdErrSerialize===void 0?!0:b._stdErrSerialize),b._logEvent.ts=q,b._logEvent.messages=I.filter(function(x){return D.indexOf(x)===-1}),b._logEvent.level.label=B,b._logEvent.level.value=K,U(B,b._logEvent,ee),b._logEvent=g(D)}function g(b){return{ts:0,messages:[],bindings:b||[],level:{label:"",value:0}}}function d(b){const E={type:b.constructor.name,msg:b.message,stack:b.stack};for(const I in b)E[I]===void 0&&(E[I]=b[I]);return E}function v(b){return typeof b.timestamp=="function"?b.timestamp:b.timestamp===!1?A:N}function p(){return{}}function _(b){return b}function $(){}function A(){return!1}function N(){return Date.now()}function L(){return Math.round(Date.now()/1e3)}function R(){return new Date(Date.now()).toISOString()}function z(){function b(E){return typeof E<"u"&&E}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return b(self)||b(window)||b(this)||{}}}return wi}var gt={},Es;function Er(){return Es||(Es=1,Object.defineProperty(gt,"__esModule",{value:!0}),gt.PINO_CUSTOM_CONTEXT_KEY=gt.PINO_LOGGER_DEFAULTS=void 0,gt.PINO_LOGGER_DEFAULTS={level:"info"},gt.PINO_CUSTOM_CONTEXT_KEY="custom_context"),gt}var Le={},_s;function _a(){if(_s)return Le;_s=1,Object.defineProperty(Le,"__esModule",{value:!0}),Le.generateChildLogger=Le.formatChildLoggerContext=Le.getLoggerContext=Le.setBrowserLoggerContext=Le.getBrowserLoggerContext=Le.getDefaultLoggerOptions=void 0;const i=Er();function e(u){return Object.assign(Object.assign({},u),{level:(u==null?void 0:u.level)||i.PINO_LOGGER_DEFAULTS.level})}Le.getDefaultLoggerOptions=e;function t(u,l=i.PINO_CUSTOM_CONTEXT_KEY){return u[l]||""}Le.getBrowserLoggerContext=t;function s(u,l,c=i.PINO_CUSTOM_CONTEXT_KEY){return u[c]=l,u}Le.setBrowserLoggerContext=s;function r(u,l=i.PINO_CUSTOM_CONTEXT_KEY){let c="";return typeof u.bindings>"u"?c=t(u,l):c=u.bindings().context||"",c}Le.getLoggerContext=r;function n(u,l,c=i.PINO_CUSTOM_CONTEXT_KEY){const h=r(u,c);return h.trim()?`${h}/${l}`:l}Le.formatChildLoggerContext=n;function a(u,l,c=i.PINO_CUSTOM_CONTEXT_KEY){const h=n(u,l,c),g=u.child({context:h});return s(g,h,c)}return Le.generateChildLogger=a,Le}(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.pino=void 0;const e=wa,t=e.__importDefault(Ea());Object.defineProperty(i,"pino",{enumerable:!0,get:function(){return t.default}}),e.__exportStar(Er(),i),e.__exportStar(_a(),i)})(k);class xa extends Dt{constructor(e){super(),this.opts=e,this.protocol="wc",this.version=2}}let Sa=class extends Dt{constructor(e,t){super(),this.core=e,this.logger=t,this.records=new Map}},Ia=class{constructor(e,t){this.logger=e,this.core=t}};class Ca extends Dt{constructor(e,t){super(),this.relayer=e,this.logger=t}}let Pa=class extends Dt{constructor(e){super()}};class Oa{constructor(e,t,s,r){this.core=e,this.logger=t,this.name=s}}class Ra extends Dt{constructor(e,t){super(),this.relayer=e,this.logger=t}}class Aa extends Dt{constructor(e,t){super(),this.core=e,this.logger=t}}class Ta{constructor(e,t){this.projectId=e,this.logger=t}}let Na=class{constructor(e,t){this.projectId=e,this.logger=t}},$a=class{constructor(e){this.opts=e,this.protocol="wc",this.version=2}},La=class{constructor(e){this.client=e}};var Bi={},_r={};(function(i){Object.defineProperty(i,"__esModule",{value:!0});var e=nn,t=ar;i.DIGEST_LENGTH=64,i.BLOCK_SIZE=128;var s=function(){function u(){this.digestLength=i.DIGEST_LENGTH,this.blockSize=i.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return u.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},u.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},u.prototype.clean=function(){t.wipe(this._buffer),t.wipe(this._tempHi),t.wipe(this._tempLo),this.reset()},u.prototype.update=function(l,c){if(c===void 0&&(c=l.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var h=0;if(this._bytesHashed+=c,this._bufferLength>0){for(;this._bufferLength<i.BLOCK_SIZE&&c>0;)this._buffer[this._bufferLength++]=l[h++],c--;this._bufferLength===this.blockSize&&(n(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(c>=this.blockSize&&(h=n(this._tempHi,this._tempLo,this._stateHi,this._stateLo,l,h,c),c%=this.blockSize);c>0;)this._buffer[this._bufferLength++]=l[h++],c--;return this},u.prototype.finish=function(l){if(!this._finished){var c=this._bytesHashed,h=this._bufferLength,g=c/536870912|0,d=c<<3,v=c%128<112?128:256;this._buffer[h]=128;for(var p=h+1;p<v-8;p++)this._buffer[p]=0;e.writeUint32BE(g,this._buffer,v-8),e.writeUint32BE(d,this._buffer,v-4),n(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,v),this._finished=!0}for(var p=0;p<this.digestLength/8;p++)e.writeUint32BE(this._stateHi[p],l,p*8),e.writeUint32BE(this._stateLo[p],l,p*8+4);return this},u.prototype.digest=function(){var l=new Uint8Array(this.digestLength);return this.finish(l),l},u.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},u.prototype.restoreState=function(l){return this._stateHi.set(l.stateHi),this._stateLo.set(l.stateLo),this._bufferLength=l.bufferLength,l.buffer&&this._buffer.set(l.buffer),this._bytesHashed=l.bytesHashed,this._finished=!1,this},u.prototype.cleanSavedState=function(l){t.wipe(l.stateHi),t.wipe(l.stateLo),l.buffer&&t.wipe(l.buffer),l.bufferLength=0,l.bytesHashed=0},u}();i.SHA512=s;var r=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function n(u,l,c,h,g,d,v){for(var p=c[0],_=c[1],$=c[2],A=c[3],N=c[4],L=c[5],R=c[6],z=c[7],b=h[0],E=h[1],I=h[2],U=h[3],q=h[4],B=h[5],K=h[6],ee=h[7],D,x,G,Q,T,C,S,O;v>=128;){for(var re=0;re<16;re++){var Y=8*re+d;u[re]=e.readUint32BE(g,Y),l[re]=e.readUint32BE(g,Y+4)}for(var re=0;re<80;re++){var bt=p,mt=_,ke=$,m=A,w=N,y=L,o=R,f=z,M=b,F=E,H=I,W=U,V=q,J=B,Te=K,ae=ee;if(D=z,x=ee,T=x&65535,C=x>>>16,S=D&65535,O=D>>>16,D=(N>>>14|q<<18)^(N>>>18|q<<14)^(q>>>9|N<<23),x=(q>>>14|N<<18)^(q>>>18|N<<14)^(N>>>9|q<<23),T+=x&65535,C+=x>>>16,S+=D&65535,O+=D>>>16,D=N&L^~N&R,x=q&B^~q&K,T+=x&65535,C+=x>>>16,S+=D&65535,O+=D>>>16,D=r[re*2],x=r[re*2+1],T+=x&65535,C+=x>>>16,S+=D&65535,O+=D>>>16,D=u[re%16],x=l[re%16],T+=x&65535,C+=x>>>16,S+=D&65535,O+=D>>>16,C+=T>>>16,S+=C>>>16,O+=S>>>16,G=S&65535|O<<16,Q=T&65535|C<<16,D=G,x=Q,T=x&65535,C=x>>>16,S=D&65535,O=D>>>16,D=(p>>>28|b<<4)^(b>>>2|p<<30)^(b>>>7|p<<25),x=(b>>>28|p<<4)^(p>>>2|b<<30)^(p>>>7|b<<25),T+=x&65535,C+=x>>>16,S+=D&65535,O+=D>>>16,D=p&_^p&$^_&$,x=b&E^b&I^E&I,T+=x&65535,C+=x>>>16,S+=D&65535,O+=D>>>16,C+=T>>>16,S+=C>>>16,O+=S>>>16,f=S&65535|O<<16,ae=T&65535|C<<16,D=m,x=W,T=x&65535,C=x>>>16,S=D&65535,O=D>>>16,D=G,x=Q,T+=x&65535,C+=x>>>16,S+=D&65535,O+=D>>>16,C+=T>>>16,S+=C>>>16,O+=S>>>16,m=S&65535|O<<16,W=T&65535|C<<16,_=bt,$=mt,A=ke,N=m,L=w,R=y,z=o,p=f,E=M,I=F,U=H,q=W,B=V,K=J,ee=Te,b=ae,re%16===15)for(var Y=0;Y<16;Y++)D=u[Y],x=l[Y],T=x&65535,C=x>>>16,S=D&65535,O=D>>>16,D=u[(Y+9)%16],x=l[(Y+9)%16],T+=x&65535,C+=x>>>16,S+=D&65535,O+=D>>>16,G=u[(Y+1)%16],Q=l[(Y+1)%16],D=(G>>>1|Q<<31)^(G>>>8|Q<<24)^G>>>7,x=(Q>>>1|G<<31)^(Q>>>8|G<<24)^(Q>>>7|G<<25),T+=x&65535,C+=x>>>16,S+=D&65535,O+=D>>>16,G=u[(Y+14)%16],Q=l[(Y+14)%16],D=(G>>>19|Q<<13)^(Q>>>29|G<<3)^G>>>6,x=(Q>>>19|G<<13)^(G>>>29|Q<<3)^(Q>>>6|G<<26),T+=x&65535,C+=x>>>16,S+=D&65535,O+=D>>>16,C+=T>>>16,S+=C>>>16,O+=S>>>16,u[Y]=S&65535|O<<16,l[Y]=T&65535|C<<16}D=p,x=b,T=x&65535,C=x>>>16,S=D&65535,O=D>>>16,D=c[0],x=h[0],T+=x&65535,C+=x>>>16,S+=D&65535,O+=D>>>16,C+=T>>>16,S+=C>>>16,O+=S>>>16,c[0]=p=S&65535|O<<16,h[0]=b=T&65535|C<<16,D=_,x=E,T=x&65535,C=x>>>16,S=D&65535,O=D>>>16,D=c[1],x=h[1],T+=x&65535,C+=x>>>16,S+=D&65535,O+=D>>>16,C+=T>>>16,S+=C>>>16,O+=S>>>16,c[1]=_=S&65535|O<<16,h[1]=E=T&65535|C<<16,D=$,x=I,T=x&65535,C=x>>>16,S=D&65535,O=D>>>16,D=c[2],x=h[2],T+=x&65535,C+=x>>>16,S+=D&65535,O+=D>>>16,C+=T>>>16,S+=C>>>16,O+=S>>>16,c[2]=$=S&65535|O<<16,h[2]=I=T&65535|C<<16,D=A,x=U,T=x&65535,C=x>>>16,S=D&65535,O=D>>>16,D=c[3],x=h[3],T+=x&65535,C+=x>>>16,S+=D&65535,O+=D>>>16,C+=T>>>16,S+=C>>>16,O+=S>>>16,c[3]=A=S&65535|O<<16,h[3]=U=T&65535|C<<16,D=N,x=q,T=x&65535,C=x>>>16,S=D&65535,O=D>>>16,D=c[4],x=h[4],T+=x&65535,C+=x>>>16,S+=D&65535,O+=D>>>16,C+=T>>>16,S+=C>>>16,O+=S>>>16,c[4]=N=S&65535|O<<16,h[4]=q=T&65535|C<<16,D=L,x=B,T=x&65535,C=x>>>16,S=D&65535,O=D>>>16,D=c[5],x=h[5],T+=x&65535,C+=x>>>16,S+=D&65535,O+=D>>>16,C+=T>>>16,S+=C>>>16,O+=S>>>16,c[5]=L=S&65535|O<<16,h[5]=B=T&65535|C<<16,D=R,x=K,T=x&65535,C=x>>>16,S=D&65535,O=D>>>16,D=c[6],x=h[6],T+=x&65535,C+=x>>>16,S+=D&65535,O+=D>>>16,C+=T>>>16,S+=C>>>16,O+=S>>>16,c[6]=R=S&65535|O<<16,h[6]=K=T&65535|C<<16,D=z,x=ee,T=x&65535,C=x>>>16,S=D&65535,O=D>>>16,D=c[7],x=h[7],T+=x&65535,C+=x>>>16,S+=D&65535,O+=D>>>16,C+=T>>>16,S+=C>>>16,O+=S>>>16,c[7]=z=S&65535|O<<16,h[7]=ee=T&65535|C<<16,d+=128,v-=128}return d}function a(u){var l=new s;l.update(u);var c=l.digest();return l.clean(),c}i.hash=a})(_r);(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.convertSecretKeyToX25519=i.convertPublicKeyToX25519=i.verify=i.sign=i.extractPublicKeyFromSecretKey=i.generateKeyPair=i.generateKeyPairFromSeed=i.SEED_LENGTH=i.SECRET_KEY_LENGTH=i.PUBLIC_KEY_LENGTH=i.SIGNATURE_LENGTH=void 0;const e=cr,t=_r,s=ar;i.SIGNATURE_LENGTH=64,i.PUBLIC_KEY_LENGTH=32,i.SECRET_KEY_LENGTH=64,i.SEED_LENGTH=32;function r(m){const w=new Float64Array(16);if(m)for(let y=0;y<m.length;y++)w[y]=m[y];return w}const n=new Uint8Array(32);n[0]=9;const a=r(),u=r([1]),l=r([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),c=r([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),h=r([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),g=r([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),d=r([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function v(m,w){for(let y=0;y<16;y++)m[y]=w[y]|0}function p(m){let w=1;for(let y=0;y<16;y++){let o=m[y]+w+65535;w=Math.floor(o/65536),m[y]=o-w*65536}m[0]+=w-1+37*(w-1)}function _(m,w,y){const o=~(y-1);for(let f=0;f<16;f++){const M=o&(m[f]^w[f]);m[f]^=M,w[f]^=M}}function $(m,w){const y=r(),o=r();for(let f=0;f<16;f++)o[f]=w[f];p(o),p(o),p(o);for(let f=0;f<2;f++){y[0]=o[0]-65517;for(let F=1;F<15;F++)y[F]=o[F]-65535-(y[F-1]>>16&1),y[F-1]&=65535;y[15]=o[15]-32767-(y[14]>>16&1);const M=y[15]>>16&1;y[14]&=65535,_(o,y,1-M)}for(let f=0;f<16;f++)m[2*f]=o[f]&255,m[2*f+1]=o[f]>>8}function A(m,w){let y=0;for(let o=0;o<32;o++)y|=m[o]^w[o];return(1&y-1>>>8)-1}function N(m,w){const y=new Uint8Array(32),o=new Uint8Array(32);return $(y,m),$(o,w),A(y,o)}function L(m){const w=new Uint8Array(32);return $(w,m),w[0]&1}function R(m,w){for(let y=0;y<16;y++)m[y]=w[2*y]+(w[2*y+1]<<8);m[15]&=32767}function z(m,w,y){for(let o=0;o<16;o++)m[o]=w[o]+y[o]}function b(m,w,y){for(let o=0;o<16;o++)m[o]=w[o]-y[o]}function E(m,w,y){let o,f,M=0,F=0,H=0,W=0,V=0,J=0,Te=0,ae=0,Ne=0,fe=0,ce=0,ne=0,se=0,te=0,X=0,Z=0,de=0,$e=0,Me=0,Ue=0,Be=0,Ke=0,Ye=0,et=0,ct=0,dt=0,wt=0,Pt=0,Wt=0,li=0,is=0,pe=y[0],ge=y[1],ye=y[2],De=y[3],be=y[4],me=y[5],we=y[6],ve=y[7],Ee=y[8],_e=y[9],xe=y[10],Se=y[11],Ie=y[12],Ce=y[13],Pe=y[14],Oe=y[15];o=w[0],M+=o*pe,F+=o*ge,H+=o*ye,W+=o*De,V+=o*be,J+=o*me,Te+=o*we,ae+=o*ve,Ne+=o*Ee,fe+=o*_e,ce+=o*xe,ne+=o*Se,se+=o*Ie,te+=o*Ce,X+=o*Pe,Z+=o*Oe,o=w[1],F+=o*pe,H+=o*ge,W+=o*ye,V+=o*De,J+=o*be,Te+=o*me,ae+=o*we,Ne+=o*ve,fe+=o*Ee,ce+=o*_e,ne+=o*xe,se+=o*Se,te+=o*Ie,X+=o*Ce,Z+=o*Pe,de+=o*Oe,o=w[2],H+=o*pe,W+=o*ge,V+=o*ye,J+=o*De,Te+=o*be,ae+=o*me,Ne+=o*we,fe+=o*ve,ce+=o*Ee,ne+=o*_e,se+=o*xe,te+=o*Se,X+=o*Ie,Z+=o*Ce,de+=o*Pe,$e+=o*Oe,o=w[3],W+=o*pe,V+=o*ge,J+=o*ye,Te+=o*De,ae+=o*be,Ne+=o*me,fe+=o*we,ce+=o*ve,ne+=o*Ee,se+=o*_e,te+=o*xe,X+=o*Se,Z+=o*Ie,de+=o*Ce,$e+=o*Pe,Me+=o*Oe,o=w[4],V+=o*pe,J+=o*ge,Te+=o*ye,ae+=o*De,Ne+=o*be,fe+=o*me,ce+=o*we,ne+=o*ve,se+=o*Ee,te+=o*_e,X+=o*xe,Z+=o*Se,de+=o*Ie,$e+=o*Ce,Me+=o*Pe,Ue+=o*Oe,o=w[5],J+=o*pe,Te+=o*ge,ae+=o*ye,Ne+=o*De,fe+=o*be,ce+=o*me,ne+=o*we,se+=o*ve,te+=o*Ee,X+=o*_e,Z+=o*xe,de+=o*Se,$e+=o*Ie,Me+=o*Ce,Ue+=o*Pe,Be+=o*Oe,o=w[6],Te+=o*pe,ae+=o*ge,Ne+=o*ye,fe+=o*De,ce+=o*be,ne+=o*me,se+=o*we,te+=o*ve,X+=o*Ee,Z+=o*_e,de+=o*xe,$e+=o*Se,Me+=o*Ie,Ue+=o*Ce,Be+=o*Pe,Ke+=o*Oe,o=w[7],ae+=o*pe,Ne+=o*ge,fe+=o*ye,ce+=o*De,ne+=o*be,se+=o*me,te+=o*we,X+=o*ve,Z+=o*Ee,de+=o*_e,$e+=o*xe,Me+=o*Se,Ue+=o*Ie,Be+=o*Ce,Ke+=o*Pe,Ye+=o*Oe,o=w[8],Ne+=o*pe,fe+=o*ge,ce+=o*ye,ne+=o*De,se+=o*be,te+=o*me,X+=o*we,Z+=o*ve,de+=o*Ee,$e+=o*_e,Me+=o*xe,Ue+=o*Se,Be+=o*Ie,Ke+=o*Ce,Ye+=o*Pe,et+=o*Oe,o=w[9],fe+=o*pe,ce+=o*ge,ne+=o*ye,se+=o*De,te+=o*be,X+=o*me,Z+=o*we,de+=o*ve,$e+=o*Ee,Me+=o*_e,Ue+=o*xe,Be+=o*Se,Ke+=o*Ie,Ye+=o*Ce,et+=o*Pe,ct+=o*Oe,o=w[10],ce+=o*pe,ne+=o*ge,se+=o*ye,te+=o*De,X+=o*be,Z+=o*me,de+=o*we,$e+=o*ve,Me+=o*Ee,Ue+=o*_e,Be+=o*xe,Ke+=o*Se,Ye+=o*Ie,et+=o*Ce,ct+=o*Pe,dt+=o*Oe,o=w[11],ne+=o*pe,se+=o*ge,te+=o*ye,X+=o*De,Z+=o*be,de+=o*me,$e+=o*we,Me+=o*ve,Ue+=o*Ee,Be+=o*_e,Ke+=o*xe,Ye+=o*Se,et+=o*Ie,ct+=o*Ce,dt+=o*Pe,wt+=o*Oe,o=w[12],se+=o*pe,te+=o*ge,X+=o*ye,Z+=o*De,de+=o*be,$e+=o*me,Me+=o*we,Ue+=o*ve,Be+=o*Ee,Ke+=o*_e,Ye+=o*xe,et+=o*Se,ct+=o*Ie,dt+=o*Ce,wt+=o*Pe,Pt+=o*Oe,o=w[13],te+=o*pe,X+=o*ge,Z+=o*ye,de+=o*De,$e+=o*be,Me+=o*me,Ue+=o*we,Be+=o*ve,Ke+=o*Ee,Ye+=o*_e,et+=o*xe,ct+=o*Se,dt+=o*Ie,wt+=o*Ce,Pt+=o*Pe,Wt+=o*Oe,o=w[14],X+=o*pe,Z+=o*ge,de+=o*ye,$e+=o*De,Me+=o*be,Ue+=o*me,Be+=o*we,Ke+=o*ve,Ye+=o*Ee,et+=o*_e,ct+=o*xe,dt+=o*Se,wt+=o*Ie,Pt+=o*Ce,Wt+=o*Pe,li+=o*Oe,o=w[15],Z+=o*pe,de+=o*ge,$e+=o*ye,Me+=o*De,Ue+=o*be,Be+=o*me,Ke+=o*we,Ye+=o*ve,et+=o*Ee,ct+=o*_e,dt+=o*xe,wt+=o*Se,Pt+=o*Ie,Wt+=o*Ce,li+=o*Pe,is+=o*Oe,M+=38*de,F+=38*$e,H+=38*Me,W+=38*Ue,V+=38*Be,J+=38*Ke,Te+=38*Ye,ae+=38*et,Ne+=38*ct,fe+=38*dt,ce+=38*wt,ne+=38*Pt,se+=38*Wt,te+=38*li,X+=38*is,f=1,o=M+f+65535,f=Math.floor(o/65536),M=o-f*65536,o=F+f+65535,f=Math.floor(o/65536),F=o-f*65536,o=H+f+65535,f=Math.floor(o/65536),H=o-f*65536,o=W+f+65535,f=Math.floor(o/65536),W=o-f*65536,o=V+f+65535,f=Math.floor(o/65536),V=o-f*65536,o=J+f+65535,f=Math.floor(o/65536),J=o-f*65536,o=Te+f+65535,f=Math.floor(o/65536),Te=o-f*65536,o=ae+f+65535,f=Math.floor(o/65536),ae=o-f*65536,o=Ne+f+65535,f=Math.floor(o/65536),Ne=o-f*65536,o=fe+f+65535,f=Math.floor(o/65536),fe=o-f*65536,o=ce+f+65535,f=Math.floor(o/65536),ce=o-f*65536,o=ne+f+65535,f=Math.floor(o/65536),ne=o-f*65536,o=se+f+65535,f=Math.floor(o/65536),se=o-f*65536,o=te+f+65535,f=Math.floor(o/65536),te=o-f*65536,o=X+f+65535,f=Math.floor(o/65536),X=o-f*65536,o=Z+f+65535,f=Math.floor(o/65536),Z=o-f*65536,M+=f-1+37*(f-1),f=1,o=M+f+65535,f=Math.floor(o/65536),M=o-f*65536,o=F+f+65535,f=Math.floor(o/65536),F=o-f*65536,o=H+f+65535,f=Math.floor(o/65536),H=o-f*65536,o=W+f+65535,f=Math.floor(o/65536),W=o-f*65536,o=V+f+65535,f=Math.floor(o/65536),V=o-f*65536,o=J+f+65535,f=Math.floor(o/65536),J=o-f*65536,o=Te+f+65535,f=Math.floor(o/65536),Te=o-f*65536,o=ae+f+65535,f=Math.floor(o/65536),ae=o-f*65536,o=Ne+f+65535,f=Math.floor(o/65536),Ne=o-f*65536,o=fe+f+65535,f=Math.floor(o/65536),fe=o-f*65536,o=ce+f+65535,f=Math.floor(o/65536),ce=o-f*65536,o=ne+f+65535,f=Math.floor(o/65536),ne=o-f*65536,o=se+f+65535,f=Math.floor(o/65536),se=o-f*65536,o=te+f+65535,f=Math.floor(o/65536),te=o-f*65536,o=X+f+65535,f=Math.floor(o/65536),X=o-f*65536,o=Z+f+65535,f=Math.floor(o/65536),Z=o-f*65536,M+=f-1+37*(f-1),m[0]=M,m[1]=F,m[2]=H,m[3]=W,m[4]=V,m[5]=J,m[6]=Te,m[7]=ae,m[8]=Ne,m[9]=fe,m[10]=ce,m[11]=ne,m[12]=se,m[13]=te,m[14]=X,m[15]=Z}function I(m,w){E(m,w,w)}function U(m,w){const y=r();let o;for(o=0;o<16;o++)y[o]=w[o];for(o=253;o>=0;o--)I(y,y),o!==2&&o!==4&&E(y,y,w);for(o=0;o<16;o++)m[o]=y[o]}function q(m,w){const y=r();let o;for(o=0;o<16;o++)y[o]=w[o];for(o=250;o>=0;o--)I(y,y),o!==1&&E(y,y,w);for(o=0;o<16;o++)m[o]=y[o]}function B(m,w){const y=r(),o=r(),f=r(),M=r(),F=r(),H=r(),W=r(),V=r(),J=r();b(y,m[1],m[0]),b(J,w[1],w[0]),E(y,y,J),z(o,m[0],m[1]),z(J,w[0],w[1]),E(o,o,J),E(f,m[3],w[3]),E(f,f,c),E(M,m[2],w[2]),z(M,M,M),b(F,o,y),b(H,M,f),z(W,M,f),z(V,o,y),E(m[0],F,H),E(m[1],V,W),E(m[2],W,H),E(m[3],F,V)}function K(m,w,y){for(let o=0;o<4;o++)_(m[o],w[o],y)}function ee(m,w){const y=r(),o=r(),f=r();U(f,w[2]),E(y,w[0],f),E(o,w[1],f),$(m,o),m[31]^=L(y)<<7}function D(m,w,y){v(m[0],a),v(m[1],u),v(m[2],u),v(m[3],a);for(let o=255;o>=0;--o){const f=y[o/8|0]>>(o&7)&1;K(m,w,f),B(w,m),B(m,m),K(m,w,f)}}function x(m,w){const y=[r(),r(),r(),r()];v(y[0],h),v(y[1],g),v(y[2],u),E(y[3],h,g),D(m,y,w)}function G(m){if(m.length!==i.SEED_LENGTH)throw new Error(`ed25519: seed must be ${i.SEED_LENGTH} bytes`);const w=(0,t.hash)(m);w[0]&=248,w[31]&=127,w[31]|=64;const y=new Uint8Array(32),o=[r(),r(),r(),r()];x(o,w),ee(y,o);const f=new Uint8Array(64);return f.set(m),f.set(y,32),{publicKey:y,secretKey:f}}i.generateKeyPairFromSeed=G;function Q(m){const w=(0,e.randomBytes)(32,m),y=G(w);return(0,s.wipe)(w),y}i.generateKeyPair=Q;function T(m){if(m.length!==i.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${i.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(m.subarray(32))}i.extractPublicKeyFromSecretKey=T;const C=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function S(m,w){let y,o,f,M;for(o=63;o>=32;--o){for(y=0,f=o-32,M=o-12;f<M;++f)w[f]+=y-16*w[o]*C[f-(o-32)],y=Math.floor((w[f]+128)/256),w[f]-=y*256;w[f]+=y,w[o]=0}for(y=0,f=0;f<32;f++)w[f]+=y-(w[31]>>4)*C[f],y=w[f]>>8,w[f]&=255;for(f=0;f<32;f++)w[f]-=y*C[f];for(o=0;o<32;o++)w[o+1]+=w[o]>>8,m[o]=w[o]&255}function O(m){const w=new Float64Array(64);for(let y=0;y<64;y++)w[y]=m[y];for(let y=0;y<64;y++)m[y]=0;S(m,w)}function re(m,w){const y=new Float64Array(64),o=[r(),r(),r(),r()],f=(0,t.hash)(m.subarray(0,32));f[0]&=248,f[31]&=127,f[31]|=64;const M=new Uint8Array(64);M.set(f.subarray(32),32);const F=new t.SHA512;F.update(M.subarray(32)),F.update(w);const H=F.digest();F.clean(),O(H),x(o,H),ee(M,o),F.reset(),F.update(M.subarray(0,32)),F.update(m.subarray(32)),F.update(w);const W=F.digest();O(W);for(let V=0;V<32;V++)y[V]=H[V];for(let V=0;V<32;V++)for(let J=0;J<32;J++)y[V+J]+=W[V]*f[J];return S(M.subarray(32),y),M}i.sign=re;function Y(m,w){const y=r(),o=r(),f=r(),M=r(),F=r(),H=r(),W=r();return v(m[2],u),R(m[1],w),I(f,m[1]),E(M,f,l),b(f,f,m[2]),z(M,m[2],M),I(F,M),I(H,F),E(W,H,F),E(y,W,f),E(y,y,M),q(y,y),E(y,y,f),E(y,y,M),E(y,y,M),E(m[0],y,M),I(o,m[0]),E(o,o,M),N(o,f)&&E(m[0],m[0],d),I(o,m[0]),E(o,o,M),N(o,f)?-1:(L(m[0])===w[31]>>7&&b(m[0],a,m[0]),E(m[3],m[0],m[1]),0)}function bt(m,w,y){const o=new Uint8Array(32),f=[r(),r(),r(),r()],M=[r(),r(),r(),r()];if(y.length!==i.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${i.SIGNATURE_LENGTH} bytes`);if(Y(M,m))return!1;const F=new t.SHA512;F.update(y.subarray(0,32)),F.update(m),F.update(w);const H=F.digest();return O(H),D(f,M,H),x(M,y.subarray(32)),B(f,M),ee(o,f),!A(y,o)}i.verify=bt;function mt(m){let w=[r(),r(),r(),r()];if(Y(w,m))throw new Error("Ed25519: invalid public key");let y=r(),o=r(),f=w[1];z(y,u,f),b(o,u,f),U(o,o),E(y,y,o);let M=new Uint8Array(32);return $(M,y),M}i.convertPublicKeyToX25519=mt;function ke(m){const w=(0,t.hash)(m.subarray(0,32));w[0]&=248,w[31]&=127,w[31]|=64;const y=new Uint8Array(w.subarray(0,32));return(0,s.wipe)(w),y}i.convertSecretKeyToX25519=ke})(Bi);const Ma="EdDSA",ja="JWT",xr=".",Sr="base64url",za="utf8",qa="utf8",Ua=":",Fa="did",ka="key",xs="base58btc",Ba="z",Va="K36",Ka=32;function Vi(i){return globalThis.Buffer!=null?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):i}function Ir(i=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Vi(globalThis.Buffer.allocUnsafe(i)):new Uint8Array(i)}function Ha(i,e){e||(e=i.reduce((r,n)=>r+n.length,0));const t=Ir(e);let s=0;for(const r of i)t.set(r,s),s+=r.length;return Vi(t)}function Ga(i,e){if(i.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),s=0;s<t.length;s++)t[s]=255;for(var r=0;r<i.length;r++){var n=i.charAt(r),a=n.charCodeAt(0);if(t[a]!==255)throw new TypeError(n+" is ambiguous");t[a]=r}var u=i.length,l=i.charAt(0),c=Math.log(u)/Math.log(256),h=Math.log(256)/Math.log(u);function g(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var _=0,$=0,A=0,N=p.length;A!==N&&p[A]===0;)A++,_++;for(var L=(N-A)*h+1>>>0,R=new Uint8Array(L);A!==N;){for(var z=p[A],b=0,E=L-1;(z!==0||b<$)&&E!==-1;E--,b++)z+=256*R[E]>>>0,R[E]=z%u>>>0,z=z/u>>>0;if(z!==0)throw new Error("Non-zero carry");$=b,A++}for(var I=L-$;I!==L&&R[I]===0;)I++;for(var U=l.repeat(_);I<L;++I)U+=i.charAt(R[I]);return U}function d(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var _=0;if(p[_]!==" "){for(var $=0,A=0;p[_]===l;)$++,_++;for(var N=(p.length-_)*c+1>>>0,L=new Uint8Array(N);p[_];){var R=t[p.charCodeAt(_)];if(R===255)return;for(var z=0,b=N-1;(R!==0||z<A)&&b!==-1;b--,z++)R+=u*L[b]>>>0,L[b]=R%256>>>0,R=R/256>>>0;if(R!==0)throw new Error("Non-zero carry");A=z,_++}if(p[_]!==" "){for(var E=N-A;E!==N&&L[E]===0;)E++;for(var I=new Uint8Array($+(N-E)),U=$;E!==N;)I[U++]=L[E++];return I}}}function v(p){var _=d(p);if(_)return _;throw new Error(`Non-${e} character`)}return{encode:g,decodeUnsafe:d,decode:v}}var Wa=Ga,Ja=Wa;const Ya=i=>{if(i instanceof Uint8Array&&i.constructor.name==="Uint8Array")return i;if(i instanceof ArrayBuffer)return new Uint8Array(i);if(ArrayBuffer.isView(i))return new Uint8Array(i.buffer,i.byteOffset,i.byteLength);throw new Error("Unknown type, must be binary type")},Qa=i=>new TextEncoder().encode(i),Xa=i=>new TextDecoder().decode(i);let Za=class{constructor(e,t,s){this.name=e,this.prefix=t,this.baseEncode=s}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},ec=class{constructor(e,t,s){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=s}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Cr(this,e)}},tc=class{constructor(e){this.decoders=e}or(e){return Cr(this,e)}decode(e){const t=e[0],s=this.decoders[t];if(s)return s.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const Cr=(i,e)=>new tc({...i.decoders||{[i.prefix]:i},...e.decoders||{[e.prefix]:e}});let ic=class{constructor(e,t,s,r){this.name=e,this.prefix=t,this.baseEncode=s,this.baseDecode=r,this.encoder=new Za(e,t,s),this.decoder=new ec(e,t,r)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const ni=({name:i,prefix:e,encode:t,decode:s})=>new ic(i,e,t,s),Kt=({prefix:i,name:e,alphabet:t})=>{const{encode:s,decode:r}=Ja(t,e);return ni({prefix:i,name:e,encode:s,decode:n=>Ya(r(n))})},sc=(i,e,t,s)=>{const r={};for(let h=0;h<e.length;++h)r[e[h]]=h;let n=i.length;for(;i[n-1]==="=";)--n;const a=new Uint8Array(n*t/8|0);let u=0,l=0,c=0;for(let h=0;h<n;++h){const g=r[i[h]];if(g===void 0)throw new SyntaxError(`Non-${s} character`);l=l<<t|g,u+=t,u>=8&&(u-=8,a[c++]=255&l>>u)}if(u>=t||255&l<<8-u)throw new SyntaxError("Unexpected end of data");return a},rc=(i,e,t)=>{const s=e[e.length-1]==="=",r=(1<<t)-1;let n="",a=0,u=0;for(let l=0;l<i.length;++l)for(u=u<<8|i[l],a+=8;a>t;)a-=t,n+=e[r&u>>a];if(a&&(n+=e[r&u<<t-a]),s)for(;n.length*t&7;)n+="=";return n},ue=({name:i,prefix:e,bitsPerChar:t,alphabet:s})=>ni({prefix:e,name:i,encode(r){return rc(r,s,t)},decode(r){return sc(r,s,t,i)}}),nc=ni({prefix:"\0",name:"identity",encode:i=>Xa(i),decode:i=>Qa(i)}),oc=Object.freeze(Object.defineProperty({__proto__:null,identity:nc},Symbol.toStringTag,{value:"Module"})),ac=ue({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),cc=Object.freeze(Object.defineProperty({__proto__:null,base2:ac},Symbol.toStringTag,{value:"Module"})),uc=ue({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),lc=Object.freeze(Object.defineProperty({__proto__:null,base8:uc},Symbol.toStringTag,{value:"Module"})),hc=Kt({prefix:"9",name:"base10",alphabet:"0123456789"}),fc=Object.freeze(Object.defineProperty({__proto__:null,base10:hc},Symbol.toStringTag,{value:"Module"})),dc=ue({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),pc=ue({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),gc=Object.freeze(Object.defineProperty({__proto__:null,base16:dc,base16upper:pc},Symbol.toStringTag,{value:"Module"})),yc=ue({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Dc=ue({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),bc=ue({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),mc=ue({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),wc=ue({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),vc=ue({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Ec=ue({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),_c=ue({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),xc=ue({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Sc=Object.freeze(Object.defineProperty({__proto__:null,base32:yc,base32hex:wc,base32hexpad:Ec,base32hexpadupper:_c,base32hexupper:vc,base32pad:bc,base32padupper:mc,base32upper:Dc,base32z:xc},Symbol.toStringTag,{value:"Module"})),Ic=Kt({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Cc=Kt({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Pc=Object.freeze(Object.defineProperty({__proto__:null,base36:Ic,base36upper:Cc},Symbol.toStringTag,{value:"Module"})),Oc=Kt({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Rc=Kt({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Ac=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Oc,base58flickr:Rc},Symbol.toStringTag,{value:"Module"})),Tc=ue({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Nc=ue({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),$c=ue({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Lc=ue({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Mc=Object.freeze(Object.defineProperty({__proto__:null,base64:Tc,base64pad:Nc,base64url:$c,base64urlpad:Lc},Symbol.toStringTag,{value:"Module"})),Pr=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),jc=Pr.reduce((i,e,t)=>(i[t]=e,i),[]),zc=Pr.reduce((i,e,t)=>(i[e.codePointAt(0)]=t,i),[]);function qc(i){return i.reduce((e,t)=>(e+=jc[t],e),"")}function Uc(i){const e=[];for(const t of i){const s=zc[t.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(s)}return new Uint8Array(e)}const Fc=ni({prefix:"🚀",name:"base256emoji",encode:qc,decode:Uc}),kc=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:Fc},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const Ss={...oc,...cc,...lc,...fc,...gc,...Sc,...Pc,...Ac,...Mc,...kc};function Or(i,e,t,s){return{name:i,prefix:e,encoder:{name:i,prefix:e,encode:t},decoder:{decode:s}}}const Is=Or("utf8","u",i=>"u"+new TextDecoder("utf8").decode(i),i=>new TextEncoder().encode(i.substring(1))),vi=Or("ascii","a",i=>{let e="a";for(let t=0;t<i.length;t++)e+=String.fromCharCode(i[t]);return e},i=>{i=i.substring(1);const e=Ir(i.length);for(let t=0;t<i.length;t++)e[t]=i.charCodeAt(t);return e}),Rr={utf8:Is,"utf-8":Is,hex:Ss.base16,latin1:vi,ascii:vi,binary:vi,...Ss};function Ki(i,e="utf8"){const t=Rr[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(i.buffer,i.byteOffset,i.byteLength).toString("utf8"):t.encoder.encode(i).substring(1)}function Hi(i,e="utf8"){const t=Rr[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Vi(globalThis.Buffer.from(i,"utf-8")):t.decoder.decode(`${t.prefix}${i}`)}function ii(i){return Ki(Hi(Vt(i),za),Sr)}function Ar(i){const e=Hi(Va,xs),t=Ba+Ki(Ha([e,i]),xs);return[Fa,ka,t].join(Ua)}function Bc(i){return Ki(i,Sr)}function Vc(i){return Hi([ii(i.header),ii(i.payload)].join(xr),qa)}function Kc(i){return[ii(i.header),ii(i.payload),Bc(i.signature)].join(xr)}function Cs(i=cr.randomBytes(Ka)){return Bi.generateKeyPairFromSeed(i)}async function Hc(i,e,t,s,r=j.fromMiliseconds(Date.now())){const n={alg:Ma,typ:ja},a=Ar(s.publicKey),u=r+t,l={iss:a,sub:i,aud:e,iat:r,exp:u},c=Vc({header:n,payload:l}),h=Bi.sign(s.secretKey,c);return Kc({header:n,payload:l,signature:h})}function Gc(i){return globalThis.Buffer!=null?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):i}function Wc(i=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Gc(globalThis.Buffer.allocUnsafe(i)):new Uint8Array(i)}function Jc(i,e){if(i.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),s=0;s<t.length;s++)t[s]=255;for(var r=0;r<i.length;r++){var n=i.charAt(r),a=n.charCodeAt(0);if(t[a]!==255)throw new TypeError(n+" is ambiguous");t[a]=r}var u=i.length,l=i.charAt(0),c=Math.log(u)/Math.log(256),h=Math.log(256)/Math.log(u);function g(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var _=0,$=0,A=0,N=p.length;A!==N&&p[A]===0;)A++,_++;for(var L=(N-A)*h+1>>>0,R=new Uint8Array(L);A!==N;){for(var z=p[A],b=0,E=L-1;(z!==0||b<$)&&E!==-1;E--,b++)z+=256*R[E]>>>0,R[E]=z%u>>>0,z=z/u>>>0;if(z!==0)throw new Error("Non-zero carry");$=b,A++}for(var I=L-$;I!==L&&R[I]===0;)I++;for(var U=l.repeat(_);I<L;++I)U+=i.charAt(R[I]);return U}function d(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var _=0;if(p[_]!==" "){for(var $=0,A=0;p[_]===l;)$++,_++;for(var N=(p.length-_)*c+1>>>0,L=new Uint8Array(N);p[_];){var R=t[p.charCodeAt(_)];if(R===255)return;for(var z=0,b=N-1;(R!==0||z<A)&&b!==-1;b--,z++)R+=u*L[b]>>>0,L[b]=R%256>>>0,R=R/256>>>0;if(R!==0)throw new Error("Non-zero carry");A=z,_++}if(p[_]!==" "){for(var E=N-A;E!==N&&L[E]===0;)E++;for(var I=new Uint8Array($+(N-E)),U=$;E!==N;)I[U++]=L[E++];return I}}}function v(p){var _=d(p);if(_)return _;throw new Error(`Non-${e} character`)}return{encode:g,decodeUnsafe:d,decode:v}}var Yc=Jc,Qc=Yc;const Xc=i=>{if(i instanceof Uint8Array&&i.constructor.name==="Uint8Array")return i;if(i instanceof ArrayBuffer)return new Uint8Array(i);if(ArrayBuffer.isView(i))return new Uint8Array(i.buffer,i.byteOffset,i.byteLength);throw new Error("Unknown type, must be binary type")},Zc=i=>new TextEncoder().encode(i),eu=i=>new TextDecoder().decode(i);class tu{constructor(e,t,s){this.name=e,this.prefix=t,this.baseEncode=s}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class iu{constructor(e,t,s){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=s}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Tr(this,e)}}class su{constructor(e){this.decoders=e}or(e){return Tr(this,e)}decode(e){const t=e[0],s=this.decoders[t];if(s)return s.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Tr=(i,e)=>new su({...i.decoders||{[i.prefix]:i},...e.decoders||{[e.prefix]:e}});class ru{constructor(e,t,s,r){this.name=e,this.prefix=t,this.baseEncode=s,this.baseDecode=r,this.encoder=new tu(e,t,s),this.decoder=new iu(e,t,r)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const oi=({name:i,prefix:e,encode:t,decode:s})=>new ru(i,e,t,s),Ht=({prefix:i,name:e,alphabet:t})=>{const{encode:s,decode:r}=Qc(t,e);return oi({prefix:i,name:e,encode:s,decode:n=>Xc(r(n))})},nu=(i,e,t,s)=>{const r={};for(let h=0;h<e.length;++h)r[e[h]]=h;let n=i.length;for(;i[n-1]==="=";)--n;const a=new Uint8Array(n*t/8|0);let u=0,l=0,c=0;for(let h=0;h<n;++h){const g=r[i[h]];if(g===void 0)throw new SyntaxError(`Non-${s} character`);l=l<<t|g,u+=t,u>=8&&(u-=8,a[c++]=255&l>>u)}if(u>=t||255&l<<8-u)throw new SyntaxError("Unexpected end of data");return a},ou=(i,e,t)=>{const s=e[e.length-1]==="=",r=(1<<t)-1;let n="",a=0,u=0;for(let l=0;l<i.length;++l)for(u=u<<8|i[l],a+=8;a>t;)a-=t,n+=e[r&u>>a];if(a&&(n+=e[r&u<<t-a]),s)for(;n.length*t&7;)n+="=";return n},le=({name:i,prefix:e,bitsPerChar:t,alphabet:s})=>oi({prefix:e,name:i,encode(r){return ou(r,s,t)},decode(r){return nu(r,s,t,i)}}),au=oi({prefix:"\0",name:"identity",encode:i=>eu(i),decode:i=>Zc(i)}),cu=Object.freeze(Object.defineProperty({__proto__:null,identity:au},Symbol.toStringTag,{value:"Module"})),uu=le({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),lu=Object.freeze(Object.defineProperty({__proto__:null,base2:uu},Symbol.toStringTag,{value:"Module"})),hu=le({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),fu=Object.freeze(Object.defineProperty({__proto__:null,base8:hu},Symbol.toStringTag,{value:"Module"})),du=Ht({prefix:"9",name:"base10",alphabet:"0123456789"}),pu=Object.freeze(Object.defineProperty({__proto__:null,base10:du},Symbol.toStringTag,{value:"Module"})),gu=le({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),yu=le({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Du=Object.freeze(Object.defineProperty({__proto__:null,base16:gu,base16upper:yu},Symbol.toStringTag,{value:"Module"})),bu=le({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),mu=le({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),wu=le({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),vu=le({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Eu=le({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),_u=le({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),xu=le({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Su=le({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Iu=le({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Cu=Object.freeze(Object.defineProperty({__proto__:null,base32:bu,base32hex:Eu,base32hexpad:xu,base32hexpadupper:Su,base32hexupper:_u,base32pad:wu,base32padupper:vu,base32upper:mu,base32z:Iu},Symbol.toStringTag,{value:"Module"})),Pu=Ht({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Ou=Ht({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Ru=Object.freeze(Object.defineProperty({__proto__:null,base36:Pu,base36upper:Ou},Symbol.toStringTag,{value:"Module"})),Au=Ht({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Tu=Ht({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Nu=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Au,base58flickr:Tu},Symbol.toStringTag,{value:"Module"})),$u=le({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Lu=le({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Mu=le({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),ju=le({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),zu=Object.freeze(Object.defineProperty({__proto__:null,base64:$u,base64pad:Lu,base64url:Mu,base64urlpad:ju},Symbol.toStringTag,{value:"Module"})),Nr=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),qu=Nr.reduce((i,e,t)=>(i[t]=e,i),[]),Uu=Nr.reduce((i,e,t)=>(i[e.codePointAt(0)]=t,i),[]);function Fu(i){return i.reduce((e,t)=>(e+=qu[t],e),"")}function ku(i){const e=[];for(const t of i){const s=Uu[t.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(s)}return new Uint8Array(e)}const Bu=oi({prefix:"🚀",name:"base256emoji",encode:Fu,decode:ku}),Vu=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:Bu},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const Ps={...cu,...lu,...fu,...pu,...Du,...Cu,...Ru,...Nu,...zu,...Vu};function $r(i,e,t,s){return{name:i,prefix:e,encoder:{name:i,prefix:e,encode:t},decoder:{decode:s}}}const Os=$r("utf8","u",i=>"u"+new TextDecoder("utf8").decode(i),i=>new TextEncoder().encode(i.substring(1))),Ei=$r("ascii","a",i=>{let e="a";for(let t=0;t<i.length;t++)e+=String.fromCharCode(i[t]);return e},i=>{i=i.substring(1);const e=Wc(i.length);for(let t=0;t<i.length;t++)e[t]=i.charCodeAt(t);return e}),Ku={utf8:Os,"utf-8":Os,hex:Ps.base16,latin1:Ei,ascii:Ei,binary:Ei,...Ps};function Hu(i,e="utf8"){const t=Ku[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(i.buffer,i.byteOffset,i.byteLength).toString("utf8"):t.encoder.encode(i).substring(1)}const Gu="PARSE_ERROR",Wu="INVALID_REQUEST",Ju="METHOD_NOT_FOUND",Yu="INVALID_PARAMS",Lr="INTERNAL_ERROR",Gi="SERVER_ERROR",Qu=[-32700,-32600,-32601,-32602,-32603],jt={[Gu]:{code:-32700,message:"Parse error"},[Wu]:{code:-32600,message:"Invalid Request"},[Ju]:{code:-32601,message:"Method not found"},[Yu]:{code:-32602,message:"Invalid params"},[Lr]:{code:-32603,message:"Internal error"},[Gi]:{code:-32e3,message:"Server error"}},Mr=Gi;function Xu(i){return Qu.includes(i)}function Rs(i){return Object.keys(jt).includes(i)?jt[i]:jt[Mr]}function Zu(i){const e=Object.values(jt).find(t=>t.code===i);return e||jt[Mr]}function el(i,e,t){return i.message.includes("getaddrinfo ENOTFOUND")||i.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${t} RPC url at ${e}`):i}var jr={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var ji=function(i,e){return ji=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,s){t.__proto__=s}||function(t,s){for(var r in s)s.hasOwnProperty(r)&&(t[r]=s[r])},ji(i,e)};function tl(i,e){ji(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var zi=function(){return zi=Object.assign||function(e){for(var t,s=1,r=arguments.length;s<r;s++){t=arguments[s];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},zi.apply(this,arguments)};function il(i,e){var t={};for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&e.indexOf(s)<0&&(t[s]=i[s]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(i);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(i,s[r])&&(t[s[r]]=i[s[r]]);return t}function sl(i,e,t,s){var r=arguments.length,n=r<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(i,e,t,s);else for(var u=i.length-1;u>=0;u--)(a=i[u])&&(n=(r<3?a(n):r>3?a(e,t,n):a(e,t))||n);return r>3&&n&&Object.defineProperty(e,t,n),n}function rl(i,e){return function(t,s){e(t,s,i)}}function nl(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)}function ol(i,e,t,s){function r(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function u(h){try{c(s.next(h))}catch(g){a(g)}}function l(h){try{c(s.throw(h))}catch(g){a(g)}}function c(h){h.done?n(h.value):r(h.value).then(u,l)}c((s=s.apply(i,e||[])).next())})}function al(i,e){var t={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},s,r,n,a;return a={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(c){return function(h){return l([c,h])}}function l(c){if(s)throw new TypeError("Generator is already executing.");for(;t;)try{if(s=1,r&&(n=c[0]&2?r.return:c[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,c[1])).done)return n;switch(r=0,n&&(c=[c[0]&2,n.value]),c[0]){case 0:case 1:n=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,r=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(n=t.trys,!(n=n.length>0&&n[n.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!n||c[1]>n[0]&&c[1]<n[3])){t.label=c[1];break}if(c[0]===6&&t.label<n[1]){t.label=n[1],n=c;break}if(n&&t.label<n[2]){t.label=n[2],t.ops.push(c);break}n[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(i,t)}catch(h){c=[6,h],r=0}finally{s=n=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function cl(i,e,t,s){s===void 0&&(s=t),i[s]=e[t]}function ul(i,e){for(var t in i)t!=="default"&&!e.hasOwnProperty(t)&&(e[t]=i[t])}function qi(i){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&i[e],s=0;if(t)return t.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&s>=i.length&&(i=void 0),{value:i&&i[s++],done:!i}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function zr(i,e){var t=typeof Symbol=="function"&&i[Symbol.iterator];if(!t)return i;var s=t.call(i),r,n=[],a;try{for(;(e===void 0||e-- >0)&&!(r=s.next()).done;)n.push(r.value)}catch(u){a={error:u}}finally{try{r&&!r.done&&(t=s.return)&&t.call(s)}finally{if(a)throw a.error}}return n}function ll(){for(var i=[],e=0;e<arguments.length;e++)i=i.concat(zr(arguments[e]));return i}function hl(){for(var i=0,e=0,t=arguments.length;e<t;e++)i+=arguments[e].length;for(var s=Array(i),r=0,e=0;e<t;e++)for(var n=arguments[e],a=0,u=n.length;a<u;a++,r++)s[r]=n[a];return s}function Ft(i){return this instanceof Ft?(this.v=i,this):new Ft(i)}function fl(i,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=t.apply(i,e||[]),r,n=[];return r={},a("next"),a("throw"),a("return"),r[Symbol.asyncIterator]=function(){return this},r;function a(d){s[d]&&(r[d]=function(v){return new Promise(function(p,_){n.push([d,v,p,_])>1||u(d,v)})})}function u(d,v){try{l(s[d](v))}catch(p){g(n[0][3],p)}}function l(d){d.value instanceof Ft?Promise.resolve(d.value.v).then(c,h):g(n[0][2],d)}function c(d){u("next",d)}function h(d){u("throw",d)}function g(d,v){d(v),n.shift(),n.length&&u(n[0][0],n[0][1])}}function dl(i){var e,t;return e={},s("next"),s("throw",function(r){throw r}),s("return"),e[Symbol.iterator]=function(){return this},e;function s(r,n){e[r]=i[r]?function(a){return(t=!t)?{value:Ft(i[r](a)),done:r==="return"}:n?n(a):a}:n}}function pl(i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=i[Symbol.asyncIterator],t;return e?e.call(i):(i=typeof qi=="function"?qi(i):i[Symbol.iterator](),t={},s("next"),s("throw"),s("return"),t[Symbol.asyncIterator]=function(){return this},t);function s(n){t[n]=i[n]&&function(a){return new Promise(function(u,l){a=i[n](a),r(u,l,a.done,a.value)})}}function r(n,a,u,l){Promise.resolve(l).then(function(c){n({value:c,done:u})},a)}}function gl(i,e){return Object.defineProperty?Object.defineProperty(i,"raw",{value:e}):i.raw=e,i}function yl(i){if(i&&i.__esModule)return i;var e={};if(i!=null)for(var t in i)Object.hasOwnProperty.call(i,t)&&(e[t]=i[t]);return e.default=i,e}function Dl(i){return i&&i.__esModule?i:{default:i}}function bl(i,e){if(!e.has(i))throw new TypeError("attempted to get private field on non-instance");return e.get(i)}function ml(i,e,t){if(!e.has(i))throw new TypeError("attempted to set private field on non-instance");return e.set(i,t),t}const wl=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return zi},__asyncDelegator:dl,__asyncGenerator:fl,__asyncValues:pl,__await:Ft,__awaiter:ol,__classPrivateFieldGet:bl,__classPrivateFieldSet:ml,__createBinding:cl,__decorate:sl,__exportStar:ul,__extends:tl,__generator:al,__importDefault:Dl,__importStar:yl,__makeTemplateObject:gl,__metadata:nl,__param:rl,__read:zr,__rest:il,__spread:ll,__spreadArrays:hl,__values:qi},Symbol.toStringTag,{value:"Module"})),vl=kt(wl);var it={},As;function El(){if(As)return it;As=1,Object.defineProperty(it,"__esModule",{value:!0}),it.isBrowserCryptoAvailable=it.getSubtleCrypto=it.getBrowerCrypto=void 0;function i(){return(vt===null||vt===void 0?void 0:vt.crypto)||(vt===null||vt===void 0?void 0:vt.msCrypto)||{}}it.getBrowerCrypto=i;function e(){const s=i();return s.subtle||s.webkitSubtle}it.getSubtleCrypto=e;function t(){return!!i()&&!!e()}return it.isBrowserCryptoAvailable=t,it}var st={},Ts;function _l(){if(Ts)return st;Ts=1,Object.defineProperty(st,"__esModule",{value:!0}),st.isBrowser=st.isNode=st.isReactNative=void 0;function i(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}st.isReactNative=i;function e(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}st.isNode=e;function t(){return!i()&&!e()}return st.isBrowser=t,st}(function(i){Object.defineProperty(i,"__esModule",{value:!0});const e=vl;e.__exportStar(El(),i),e.__exportStar(_l(),i)})(jr);function Wi(i=3){const e=Date.now()*Math.pow(10,i),t=Math.floor(Math.random()*Math.pow(10,i));return e+t}function qr(i=6){return BigInt(Wi(i))}function It(i,e,t){return{id:t||Wi(),jsonrpc:"2.0",method:i,params:e}}function Ji(i,e){return{id:i,jsonrpc:"2.0",result:e}}function Yi(i,e,t){return{id:i,jsonrpc:"2.0",error:xl(e,t)}}function xl(i,e){return typeof i>"u"?Rs(Lr):(typeof i=="string"&&(i=Object.assign(Object.assign({},Rs(Gi)),{message:i})),typeof e<"u"&&(i.data=e),Xu(i.code)&&(i=Zu(i.code)),i)}class Sl{}class Il extends Sl{constructor(){super()}}class Cl extends Il{constructor(e){super()}}const Pl="^wss?:";function Ol(i){const e=i.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function Rl(i,e){const t=Ol(i);return typeof t>"u"?!1:new RegExp(e).test(t)}function Ns(i){return Rl(i,Pl)}function Al(i){return new RegExp("wss?://localhost(:d{2,5})?").test(i)}function Ur(i){return typeof i=="object"&&"id"in i&&"jsonrpc"in i&&i.jsonrpc==="2.0"}function Qi(i){return Ur(i)&&"method"in i}function ai(i){return Ur(i)&&(ot(i)||Je(i))}function ot(i){return"result"in i}function Je(i){return"error"in i}class Tl extends Cl{constructor(e){super(e),this.events=new Ze.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async request(e,t){return this.requestStrict(It(e.method,e.params||[],e.id||qr().toString()),t)}async requestStrict(e,t){return new Promise(async(s,r)=>{if(!this.connection.connected)try{await this.open()}catch(n){r(n)}this.events.on(`${e.id}`,n=>{Je(n)?r(n.error):s(n.result)});try{await this.connection.send(e,t)}catch(n){r(n)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),ai(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const Nl=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),$l=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",$s=i=>i.split("?")[0],Ls=10,Ll=Nl();class Ml{constructor(e){if(this.url=e,this.events=new Ze.EventEmitter,this.registering=!1,!Ns(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,t)=>{if(typeof this.socket>"u"){t(new Error("Connection already closed"));return}this.socket.onclose=s=>{this.onClose(s),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Vt(e))}catch(t){this.onError(e.id,t)}}register(e=this.url){if(!Ns(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const t=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=t||this.events.listenerCount("open")>=t)&&this.events.setMaxListeners(t+1),new Promise((s,r)=>{this.events.once("register_error",n=>{this.resetMaxListeners(),r(n)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return r(new Error("WebSocket connection is missing or invalid"));s(this.socket)})})}return this.url=e,this.registering=!0,new Promise((t,s)=>{const r=new URLSearchParams(e).get("origin"),n=jr.isReactNative()?{headers:{origin:r}}:{rejectUnauthorized:!Al(e)},a=new Ll(e,[],n);$l()?a.onerror=u=>{const l=u;s(this.emitError(l.error))}:a.on("error",u=>{s(this.emitError(u))}),a.onopen=()=>{this.onOpen(a),t(a)}})}onOpen(e){e.onmessage=t=>this.onPayload(t),e.onclose=t=>this.onClose(t),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const t=typeof e.data=="string"?si(e.data):e.data;this.events.emit("payload",t)}onError(e,t){const s=this.parseError(t),r=s.message||s.toString(),n=Yi(e,r);this.events.emit("payload",n)}parseError(e,t=this.url){return el(e,$s(t),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Ls&&this.events.setMaxListeners(Ls)}emitError(e){const t=this.parseError(new Error((e==null?void 0:e.message)||`WebSocket connection failed for host: ${$s(this.url)}`));return this.events.emit("register_error",t),t}}function jl(i,e){return e=e||{},new Promise(function(t,s){var r=new XMLHttpRequest,n=[],a=[],u={},l=function(){return{ok:(r.status/100|0)==2,statusText:r.statusText,status:r.status,url:r.responseURL,text:function(){return Promise.resolve(r.responseText)},json:function(){return Promise.resolve(r.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([r.response]))},clone:l,headers:{keys:function(){return n},entries:function(){return a},get:function(h){return u[h.toLowerCase()]},has:function(h){return h.toLowerCase()in u}}}};for(var c in r.open(e.method||"get",i,!0),r.onload=function(){r.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(h,g,d){n.push(g=g.toLowerCase()),a.push([g,d]),u[g]=u[g]?u[g]+","+d:d}),t(l())},r.onerror=s,r.withCredentials=e.credentials=="include",e.headers)r.setRequestHeader(c,e.headers[c]);r.send(e.body||null)})}const zl=Object.freeze(Object.defineProperty({__proto__:null,default:jl},Symbol.toStringTag,{value:"Module"})),Ms=kt(zl);var ql=self.fetch||(self.fetch=Ms.default||Ms);const Ul=on(ql);var Fl={};function kl(i,e){if(i.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),s=0;s<t.length;s++)t[s]=255;for(var r=0;r<i.length;r++){var n=i.charAt(r),a=n.charCodeAt(0);if(t[a]!==255)throw new TypeError(n+" is ambiguous");t[a]=r}var u=i.length,l=i.charAt(0),c=Math.log(u)/Math.log(256),h=Math.log(256)/Math.log(u);function g(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var _=0,$=0,A=0,N=p.length;A!==N&&p[A]===0;)A++,_++;for(var L=(N-A)*h+1>>>0,R=new Uint8Array(L);A!==N;){for(var z=p[A],b=0,E=L-1;(z!==0||b<$)&&E!==-1;E--,b++)z+=256*R[E]>>>0,R[E]=z%u>>>0,z=z/u>>>0;if(z!==0)throw new Error("Non-zero carry");$=b,A++}for(var I=L-$;I!==L&&R[I]===0;)I++;for(var U=l.repeat(_);I<L;++I)U+=i.charAt(R[I]);return U}function d(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var _=0;if(p[_]!==" "){for(var $=0,A=0;p[_]===l;)$++,_++;for(var N=(p.length-_)*c+1>>>0,L=new Uint8Array(N);p[_];){var R=t[p.charCodeAt(_)];if(R===255)return;for(var z=0,b=N-1;(R!==0||z<A)&&b!==-1;b--,z++)R+=u*L[b]>>>0,L[b]=R%256>>>0,R=R/256>>>0;if(R!==0)throw new Error("Non-zero carry");A=z,_++}if(p[_]!==" "){for(var E=N-A;E!==N&&L[E]===0;)E++;for(var I=new Uint8Array($+(N-E)),U=$;E!==N;)I[U++]=L[E++];return I}}}function v(p){var _=d(p);if(_)return _;throw new Error(`Non-${e} character`)}return{encode:g,decodeUnsafe:d,decode:v}}var Bl=kl,Vl=Bl;const Fr=i=>{if(i instanceof Uint8Array&&i.constructor.name==="Uint8Array")return i;if(i instanceof ArrayBuffer)return new Uint8Array(i);if(ArrayBuffer.isView(i))return new Uint8Array(i.buffer,i.byteOffset,i.byteLength);throw new Error("Unknown type, must be binary type")},Kl=i=>new TextEncoder().encode(i),Hl=i=>new TextDecoder().decode(i);class Gl{constructor(e,t,s){this.name=e,this.prefix=t,this.baseEncode=s}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Wl{constructor(e,t,s){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=s}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return kr(this,e)}}class Jl{constructor(e){this.decoders=e}or(e){return kr(this,e)}decode(e){const t=e[0],s=this.decoders[t];if(s)return s.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const kr=(i,e)=>new Jl({...i.decoders||{[i.prefix]:i},...e.decoders||{[e.prefix]:e}});class Yl{constructor(e,t,s,r){this.name=e,this.prefix=t,this.baseEncode=s,this.baseDecode=r,this.encoder=new Gl(e,t,s),this.decoder=new Wl(e,t,r)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const ci=({name:i,prefix:e,encode:t,decode:s})=>new Yl(i,e,t,s),Gt=({prefix:i,name:e,alphabet:t})=>{const{encode:s,decode:r}=Vl(t,e);return ci({prefix:i,name:e,encode:s,decode:n=>Fr(r(n))})},Ql=(i,e,t,s)=>{const r={};for(let h=0;h<e.length;++h)r[e[h]]=h;let n=i.length;for(;i[n-1]==="=";)--n;const a=new Uint8Array(n*t/8|0);let u=0,l=0,c=0;for(let h=0;h<n;++h){const g=r[i[h]];if(g===void 0)throw new SyntaxError(`Non-${s} character`);l=l<<t|g,u+=t,u>=8&&(u-=8,a[c++]=255&l>>u)}if(u>=t||255&l<<8-u)throw new SyntaxError("Unexpected end of data");return a},Xl=(i,e,t)=>{const s=e[e.length-1]==="=",r=(1<<t)-1;let n="",a=0,u=0;for(let l=0;l<i.length;++l)for(u=u<<8|i[l],a+=8;a>t;)a-=t,n+=e[r&u>>a];if(a&&(n+=e[r&u<<t-a]),s)for(;n.length*t&7;)n+="=";return n},he=({name:i,prefix:e,bitsPerChar:t,alphabet:s})=>ci({prefix:e,name:i,encode(r){return Xl(r,s,t)},decode(r){return Ql(r,s,t,i)}}),Zl=ci({prefix:"\0",name:"identity",encode:i=>Hl(i),decode:i=>Kl(i)});var eh=Object.freeze({__proto__:null,identity:Zl});const th=he({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var ih=Object.freeze({__proto__:null,base2:th});const sh=he({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var rh=Object.freeze({__proto__:null,base8:sh});const nh=Gt({prefix:"9",name:"base10",alphabet:"0123456789"});var oh=Object.freeze({__proto__:null,base10:nh});const ah=he({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),ch=he({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var uh=Object.freeze({__proto__:null,base16:ah,base16upper:ch});const lh=he({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),hh=he({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),fh=he({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),dh=he({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),ph=he({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),gh=he({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),yh=he({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Dh=he({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),bh=he({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var mh=Object.freeze({__proto__:null,base32:lh,base32upper:hh,base32pad:fh,base32padupper:dh,base32hex:ph,base32hexupper:gh,base32hexpad:yh,base32hexpadupper:Dh,base32z:bh});const wh=Gt({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),vh=Gt({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Eh=Object.freeze({__proto__:null,base36:wh,base36upper:vh});const _h=Gt({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),xh=Gt({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Sh=Object.freeze({__proto__:null,base58btc:_h,base58flickr:xh});const Ih=he({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Ch=he({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Ph=he({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Oh=he({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Rh=Object.freeze({__proto__:null,base64:Ih,base64pad:Ch,base64url:Ph,base64urlpad:Oh});const Br=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),Ah=Br.reduce((i,e,t)=>(i[t]=e,i),[]),Th=Br.reduce((i,e,t)=>(i[e.codePointAt(0)]=t,i),[]);function Nh(i){return i.reduce((e,t)=>(e+=Ah[t],e),"")}function $h(i){const e=[];for(const t of i){const s=Th[t.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(s)}return new Uint8Array(e)}const Lh=ci({prefix:"🚀",name:"base256emoji",encode:Nh,decode:$h});var Mh=Object.freeze({__proto__:null,base256emoji:Lh}),jh=Vr,js=128,zh=127,qh=~zh,Uh=Math.pow(2,31);function Vr(i,e,t){e=e||[],t=t||0;for(var s=t;i>=Uh;)e[t++]=i&255|js,i/=128;for(;i&qh;)e[t++]=i&255|js,i>>>=7;return e[t]=i|0,Vr.bytes=t-s+1,e}var Fh=Ui,kh=128,zs=127;function Ui(i,s){var t=0,s=s||0,r=0,n=s,a,u=i.length;do{if(n>=u)throw Ui.bytes=0,new RangeError("Could not decode varint");a=i[n++],t+=r<28?(a&zs)<<r:(a&zs)*Math.pow(2,r),r+=7}while(a>=kh);return Ui.bytes=n-s,t}var Bh=Math.pow(2,7),Vh=Math.pow(2,14),Kh=Math.pow(2,21),Hh=Math.pow(2,28),Gh=Math.pow(2,35),Wh=Math.pow(2,42),Jh=Math.pow(2,49),Yh=Math.pow(2,56),Qh=Math.pow(2,63),Xh=function(i){return i<Bh?1:i<Vh?2:i<Kh?3:i<Hh?4:i<Gh?5:i<Wh?6:i<Jh?7:i<Yh?8:i<Qh?9:10},Zh={encode:jh,decode:Fh,encodingLength:Xh},Kr=Zh;const qs=(i,e,t=0)=>(Kr.encode(i,e,t),e),Us=i=>Kr.encodingLength(i),Fi=(i,e)=>{const t=e.byteLength,s=Us(i),r=s+Us(t),n=new Uint8Array(r+t);return qs(i,n,0),qs(t,n,s),n.set(e,r),new ef(i,t,e,n)};class ef{constructor(e,t,s,r){this.code=e,this.size=t,this.digest=s,this.bytes=r}}const Hr=({name:i,code:e,encode:t})=>new tf(i,e,t);class tf{constructor(e,t,s){this.name=e,this.code=t,this.encode=s}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Fi(this.code,t):t.then(s=>Fi(this.code,s))}else throw Error("Unknown type, must be binary type")}}const Gr=i=>async e=>new Uint8Array(await crypto.subtle.digest(i,e)),sf=Hr({name:"sha2-256",code:18,encode:Gr("SHA-256")}),rf=Hr({name:"sha2-512",code:19,encode:Gr("SHA-512")});var nf=Object.freeze({__proto__:null,sha256:sf,sha512:rf});const Wr=0,of="identity",Jr=Fr,af=i=>Fi(Wr,Jr(i)),cf={code:Wr,name:of,encode:Jr,digest:af};var uf=Object.freeze({__proto__:null,identity:cf});new TextEncoder,new TextDecoder;const Fs={...eh,...ih,...rh,...oh,...uh,...mh,...Eh,...Sh,...Rh,...Mh};({...nf,...uf});function Yr(i){return globalThis.Buffer!=null?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):i}function lf(i=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Yr(globalThis.Buffer.allocUnsafe(i)):new Uint8Array(i)}function Qr(i,e,t,s){return{name:i,prefix:e,encoder:{name:i,prefix:e,encode:t},decoder:{decode:s}}}const ks=Qr("utf8","u",i=>"u"+new TextDecoder("utf8").decode(i),i=>new TextEncoder().encode(i.substring(1))),_i=Qr("ascii","a",i=>{let e="a";for(let t=0;t<i.length;t++)e+=String.fromCharCode(i[t]);return e},i=>{i=i.substring(1);const e=lf(i.length);for(let t=0;t<i.length;t++)e[t]=i.charCodeAt(t);return e}),hf={utf8:ks,"utf-8":ks,hex:Fs.base16,latin1:_i,ascii:_i,binary:_i,...Fs};function ff(i,e="utf8"){const t=hf[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Yr(globalThis.Buffer.from(i,"utf-8")):t.decoder.decode(`${t.prefix}${i}`)}const Xr="wc",df=2,Xi="core",ft=`${Xr}@2:${Xi}:`,pf={name:Xi,logger:"error"},gf={database:":memory:"},yf="crypto",Bs="client_ed25519_seed",Df=j.ONE_DAY,bf="keychain",mf="0.3",wf="messages",vf="0.3",Ef=j.SIX_HOURS,_f="publisher",Zr="irn",xf="error",en="wss://relay.walletconnect.com",Vs="wss://relay.walletconnect.org",Sf="relayer",Ae={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},If="_subscription",rt={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},Cf=j.ONE_SECOND,Pf="2.11.0",Of=1e4,Rf="0.3",Af="WALLETCONNECT_CLIENT_ID",Ge={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},Tf="subscription",Nf="0.3",$f=j.FIVE_SECONDS*1e3,Lf="pairing",Mf="0.3",Tt={wc_pairingDelete:{req:{ttl:j.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:j.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:j.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:j.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:j.ONE_DAY,prompt:!1,tag:0},res:{ttl:j.ONE_DAY,prompt:!1,tag:0}}},Mt={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Xe={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},jf="history",zf="0.3",qf="expirer",Ve={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},Uf="0.3",xi="verify-api",xt="https://verify.walletconnect.com",ki="https://verify.walletconnect.org",Ff=[xt,ki],kf="echo",Bf="https://echo.walletconnect.com";class Vf{constructor(e,t){this.core=e,this.logger=t,this.keychain=new Map,this.name=bf,this.version=mf,this.initialized=!1,this.storagePrefix=ft,this.init=async()=>{if(!this.initialized){const s=await this.getKeyChain();typeof s<"u"&&(this.keychain=s),this.initialized=!0}},this.has=s=>(this.isInitialized(),this.keychain.has(s)),this.set=async(s,r)=>{this.isInitialized(),this.keychain.set(s,r),await this.persist()},this.get=s=>{this.isInitialized();const r=this.keychain.get(s);if(typeof r>"u"){const{message:n}=P("NO_MATCHING_KEY",`${this.name}: ${s}`);throw new Error(n)}return r},this.del=async s=>{this.isInitialized(),this.keychain.delete(s),await this.persist()},this.core=e,this.logger=k.generateChildLogger(t,this.name)}get context(){return k.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,dr(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?pr(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=P("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Kf{constructor(e,t,s){this.core=e,this.logger=t,this.name=yf,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=r=>(this.isInitialized(),this.keychain.has(r)),this.getClientId=async()=>{this.isInitialized();const r=await this.getClientSeed(),n=Cs(r);return Ar(n.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const r=ln();return this.setPrivateKey(r.publicKey,r.privateKey)},this.signJWT=async r=>{this.isInitialized();const n=await this.getClientSeed(),a=Cs(n),u=Pi();return await Hc(u,r,Df,a)},this.generateSharedKey=(r,n,a)=>{this.isInitialized();const u=this.getPrivateKey(r),l=hn(u,n);return this.setSymKey(l,a)},this.setSymKey=async(r,n)=>{this.isInitialized();const a=n||fn(r);return await this.keychain.set(a,r),a},this.deleteKeyPair=async r=>{this.isInitialized(),await this.keychain.del(r)},this.deleteSymKey=async r=>{this.isInitialized(),await this.keychain.del(r)},this.encode=async(r,n,a)=>{this.isInitialized();const u=dn(a),l=Vt(n);if(ss(u)){const d=u.senderPublicKey,v=u.receiverPublicKey;r=await this.generateSharedKey(d,v)}const c=this.getSymKey(r),{type:h,senderPublicKey:g}=u;return pn({type:h,symKey:c,message:l,senderPublicKey:g})},this.decode=async(r,n,a)=>{this.isInitialized();const u=gn(n,a);if(ss(u)){const l=u.receiverPublicKey,c=u.senderPublicKey;r=await this.generateSharedKey(l,c)}try{const l=this.getSymKey(r),c=yn({symKey:l,encoded:n});return si(c)}catch(l){this.logger.error(`Failed to decode message from topic: '${r}', clientId: '${await this.getClientId()}'`),this.logger.error(l)}},this.getPayloadType=r=>{const n=rs(r);return Dn(n.type)},this.getPayloadSenderPublicKey=r=>{const n=rs(r);return n.senderPublicKey?Hu(n.senderPublicKey,Cn):void 0},this.core=e,this.logger=k.generateChildLogger(t,this.name),this.keychain=s||new Vf(this.core,this.logger)}get context(){return k.getLoggerContext(this.logger)}async setPrivateKey(e,t){return await this.keychain.set(e,t),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(Bs)}catch{e=Pi(),await this.keychain.set(Bs,e)}return ff(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=P("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Hf extends Ia{constructor(e,t){super(e,t),this.logger=e,this.core=t,this.messages=new Map,this.name=wf,this.version=vf,this.initialized=!1,this.storagePrefix=ft,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const s=await this.getRelayerMessages();typeof s<"u"&&(this.messages=s),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(s){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(s)}finally{this.initialized=!0}}},this.set=async(s,r)=>{this.isInitialized();const n=St(r);let a=this.messages.get(s);return typeof a>"u"&&(a={}),typeof a[n]<"u"||(a[n]=r,this.messages.set(s,a),await this.persist()),n},this.get=s=>{this.isInitialized();let r=this.messages.get(s);return typeof r>"u"&&(r={}),r},this.has=(s,r)=>{this.isInitialized();const n=this.get(s),a=St(r);return typeof n[a]<"u"},this.del=async s=>{this.isInitialized(),this.messages.delete(s),await this.persist()},this.logger=k.generateChildLogger(e,this.name),this.core=t}get context(){return k.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,dr(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?pr(e):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:e}=P("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Gf extends Ca{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,this.events=new Ze.EventEmitter,this.name=_f,this.queue=new Map,this.publishTimeout=j.toMiliseconds(j.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(s,r,n)=>{var a;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:r,opts:n}});try{const u=(n==null?void 0:n.ttl)||Ef,l=Oi(n),c=(n==null?void 0:n.prompt)||!1,h=(n==null?void 0:n.tag)||0,g=(n==null?void 0:n.id)||qr().toString(),d={topic:s,message:r,opts:{ttl:u,relay:l,prompt:c,tag:h,id:g}},v=setTimeout(()=>this.queue.set(g,d),this.publishTimeout);try{await await zt(this.rpcPublish(s,r,u,l,c,h,g),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(g),this.relayer.events.emit(Ae.publish,d)}catch(p){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(a=n==null?void 0:n.internal)!=null&&a.throwOnFailedPublish)throw this.removeRequestFromQueue(g),p;return}finally{clearTimeout(v)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:r,opts:n}})}catch(u){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(u),u}},this.on=(s,r)=>{this.events.on(s,r)},this.once=(s,r)=>{this.events.once(s,r)},this.off=(s,r)=>{this.events.off(s,r)},this.removeListener=(s,r)=>{this.events.removeListener(s,r)},this.relayer=e,this.logger=k.generateChildLogger(t,this.name),this.registerEventListeners()}get context(){return k.getLoggerContext(this.logger)}rpcPublish(e,t,s,r,n,a,u){var l,c,h,g;const d={method:Zt(r.protocol).publish,params:{topic:e,message:t,ttl:s,prompt:n,tag:a},id:u};return ht((l=d.params)==null?void 0:l.prompt)&&((c=d.params)==null||delete c.prompt),ht((h=d.params)==null?void 0:h.tag)&&((g=d.params)==null||delete g.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:d}),this.relayer.request(d)}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async e=>{const{topic:t,message:s,opts:r}=e;await this.publish(t,s,r)})}registerEventListeners(){this.relayer.core.heartbeat.on(Ct.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Ae.connection_stalled);return}this.checkQueue()}),this.relayer.on(Ae.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}class Wf{constructor(){this.map=new Map,this.set=(e,t)=>{const s=this.get(e);this.exists(e,t)||this.map.set(e,[...s,t])},this.get=e=>this.map.get(e)||[],this.exists=(e,t)=>this.get(e).includes(t),this.delete=(e,t)=>{if(typeof t>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const s=this.get(e);if(!this.exists(e,t))return;const r=s.filter(n=>n!==t);if(!r.length){this.map.delete(e);return}this.map.set(e,r)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var Jf=Object.defineProperty,Yf=Object.defineProperties,Qf=Object.getOwnPropertyDescriptors,Ks=Object.getOwnPropertySymbols,Xf=Object.prototype.hasOwnProperty,Zf=Object.prototype.propertyIsEnumerable,Hs=(i,e,t)=>e in i?Jf(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Nt=(i,e)=>{for(var t in e||(e={}))Xf.call(e,t)&&Hs(i,t,e[t]);if(Ks)for(var t of Ks(e))Zf.call(e,t)&&Hs(i,t,e[t]);return i},Si=(i,e)=>Yf(i,Qf(e));class ed extends Ra{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,this.subscriptions=new Map,this.topicMap=new Wf,this.events=new Ze.EventEmitter,this.name=Tf,this.version=Nf,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=ft,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(s,r)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:r}});try{const n=Oi(r),a={topic:s,relay:n};this.pending.set(s,a);const u=await this.rpcSubscribe(s,n);return this.onSubscribe(u,a),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:r}}),u}catch(n){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(n),n}},this.unsubscribe=async(s,r)=>{await this.restartToComplete(),this.isInitialized(),typeof(r==null?void 0:r.id)<"u"?await this.unsubscribeById(s,r.id,r):await this.unsubscribeByTopic(s,r)},this.isSubscribed=async s=>this.topics.includes(s)?!0:await new Promise((r,n)=>{const a=new j.Watch;a.start(this.pendingSubscriptionWatchLabel);const u=setInterval(()=>{!this.pending.has(s)&&this.topics.includes(s)&&(clearInterval(u),a.stop(this.pendingSubscriptionWatchLabel),r(!0)),a.elapsed(this.pendingSubscriptionWatchLabel)>=$f&&(clearInterval(u),a.stop(this.pendingSubscriptionWatchLabel),n(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(s,r)=>{this.events.on(s,r)},this.once=(s,r)=>{this.events.once(s,r)},this.off=(s,r)=>{this.events.off(s,r)},this.removeListener=(s,r)=>{this.events.removeListener(s,r)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=e,this.logger=k.generateChildLogger(t,this.name),this.clientId=""}get context(){return k.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(e,t){let s=!1;try{s=this.getSubscription(e).topic===t}catch{}return s}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,t){const s=this.topicMap.get(e);await Promise.all(s.map(async r=>await this.unsubscribeById(e,r,t)))}async unsubscribeById(e,t,s){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:s}});try{const r=Oi(s);await this.rpcUnsubscribe(e,t,r);const n=Re("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,t,n),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:s}})}catch(r){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(r),r}}async rpcSubscribe(e,t){const s={method:Zt(t.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{await await zt(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Ae.connection_stalled)}return St(e+this.clientId)}async rpcBatchSubscribe(e){if(!e.length)return;const t=e[0].relay,s={method:Zt(t.protocol).batchSubscribe,params:{topics:e.map(r=>r.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{return await await zt(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Ae.connection_stalled)}}rpcUnsubscribe(e,t,s){const r={method:Zt(s.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r}),this.relayer.request(r)}onSubscribe(e,t){this.setSubscription(e,Si(Nt({},t),{id:e})),this.pending.delete(t.topic)}onBatchSubscribe(e){e.length&&e.forEach(t=>{this.setSubscription(t.id,Nt({},t)),this.pending.delete(t.topic)})}async onUnsubscribe(e,t,s){this.events.removeAllListeners(t),this.hasSubscription(t,e)&&this.deleteSubscription(t,s),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,t){this.subscriptions.has(e)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:t}),this.addSubscription(e,t))}addSubscription(e,t){this.subscriptions.set(e,Nt({},t)),this.topicMap.set(t.topic,e),this.events.emit(Ge.created,t)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const t=this.subscriptions.get(e);if(!t){const{message:s}=P("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(s)}return t}deleteSubscription(e,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:t});const s=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(s.topic,e),this.events.emit(Ge.deleted,Si(Nt({},s),{reason:t}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Ge.sync)}async reset(){if(this.cached.length){const e=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let t=0;t<e;t++){const s=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(Ge.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:t}=P("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){if(!e.length)return;const t=await this.rpcBatchSubscribe(e);gr(t)&&this.onBatchSubscribe(t.map((s,r)=>Si(Nt({},e[r]),{id:s})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const e=[];this.pending.forEach(t=>{e.push(t)}),await this.batchSubscribe(e)}registerEventListeners(){this.relayer.core.heartbeat.on(Ct.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(Ae.connect,async()=>{await this.onConnect()}),this.relayer.on(Ae.disconnect,()=>{this.onDisconnect()}),this.events.on(Ge.created,async e=>{const t=Ge.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),await this.persist()}),this.events.on(Ge.deleted,async e=>{const t=Ge.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=P("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(){this.restartInProgress&&await new Promise(e=>{const t=setInterval(()=>{this.restartInProgress||(clearInterval(t),e())},this.pollingInterval)})}}var td=Object.defineProperty,Gs=Object.getOwnPropertySymbols,id=Object.prototype.hasOwnProperty,sd=Object.prototype.propertyIsEnumerable,Ws=(i,e,t)=>e in i?td(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,rd=(i,e)=>{for(var t in e||(e={}))id.call(e,t)&&Ws(i,t,e[t]);if(Gs)for(var t of Gs(e))sd.call(e,t)&&Ws(i,t,e[t]);return i};class nd extends Pa{constructor(e){super(e),this.protocol="wc",this.version=2,this.events=new Ze.EventEmitter,this.name=Sf,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async t=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(t)}catch(s){throw this.logger.debug("Failed to Publish Request"),this.logger.error(s),s}},this.onPayloadHandler=t=>{this.onProviderPayload(t)},this.onConnectHandler=()=>{this.events.emit(Ae.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=t=>{this.logger.error(t),this.events.emit(Ae.error,t),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(rt.payload,this.onPayloadHandler),this.provider.on(rt.connect,this.onConnectHandler),this.provider.on(rt.disconnect,this.onDisconnectHandler),this.provider.on(rt.error,this.onProviderErrorHandler)},this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?k.generateChildLogger(e.logger,this.name):k.pino(k.getDefaultLoggerOptions({level:e.logger||xf})),this.messages=new Hf(this.logger,e.core),this.subscriber=new ed(this,this.logger),this.publisher=new Gf(this,this.logger),this.relayUrl=(e==null?void 0:e.relayUrl)||en,this.projectId=e.projectId,this.bundleId=bn(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${Vs}...`),await this.restartTransport(Vs)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},Of)}get context(){return k.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(e,t,s){this.isInitialized(),await this.publisher.publish(e,t,s),await this.recordMessageEvent({topic:e,message:t,publishedAt:Date.now()})}async subscribe(e,t){var s;this.isInitialized();let r=((s=this.subscriber.topicMap.get(e))==null?void 0:s[0])||"";if(r)return r;let n;const a=u=>{u.topic===e&&(this.subscriber.off(Ge.created,a),n())};return await Promise.all([new Promise(u=>{n=u,this.subscriber.on(Ge.created,a)}),new Promise(async u=>{r=await this.subscriber.subscribe(e,t),u()})]),r}async unsubscribe(e,t){this.isInitialized(),await this.subscriber.unsubscribe(e,t)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await zt(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(e){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(t=>{if(!this.initialized)return t();this.subscriber.once(Ge.resubscribed,()=>{t()})}),new Promise(async(t,s)=>{try{await zt(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(r){s(r);return}t()})])}catch(t){this.logger.error(t);const s=t;if(!this.isConnectionStalled(s.message))throw t;this.provider.events.emit(rt.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(e){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await ns())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(e){return this.staleConnectionErrors.some(t=>e.includes(t))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new Tl(new Ml(mn({sdkVersion:Pf,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(e){const{topic:t,message:s}=e;await this.messages.set(t,s)}async shouldIgnoreMessageEvent(e){const{topic:t,message:s}=e;if(!s||s.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${s}`),!0;if(!await this.subscriber.isSubscribed(t))return this.logger.debug(`Ignoring message for non-subscribed topic ${t}`),!0;const r=this.messages.has(t,s);return r&&this.logger.debug(`Ignoring duplicate message: ${s}`),r}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Qi(e)){if(!e.method.endsWith(If))return;const t=e.params,{topic:s,message:r,publishedAt:n}=t.data,a={topic:s,message:r,publishedAt:n};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(rd({type:"event",event:t.id},a)),this.events.emit(t.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else ai(e)&&this.events.emit(Ae.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(this.events.emit(Ae.message,e),await this.recordMessageEvent(e))}async acknowledgePayload(e){const t=Ji(e.id,!0);await this.provider.connection.send(t)}unregisterProviderListeners(){this.provider.off(rt.payload,this.onPayloadHandler),this.provider.off(rt.connect,this.onConnectHandler),this.provider.off(rt.disconnect,this.onDisconnectHandler),this.provider.off(rt.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(Ae.connection_stalled,()=>{this.restartTransport().catch(t=>this.logger.error(t))});let e=await ns();wn(async t=>{this.initialized&&e!==t&&(e=t,t?await this.restartTransport().catch(s=>this.logger.error(s)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(s=>this.logger.error(s))))})}onProviderDisconnect(){this.events.emit(Ae.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(e=>this.logger.error(e))},j.toMiliseconds(Cf)))}isInitialized(){if(!this.initialized){const{message:e}=P("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(e=>{const t=setInterval(()=>{this.connected&&(clearInterval(t),e())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var od=Object.defineProperty,Js=Object.getOwnPropertySymbols,ad=Object.prototype.hasOwnProperty,cd=Object.prototype.propertyIsEnumerable,Ys=(i,e,t)=>e in i?od(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Qs=(i,e)=>{for(var t in e||(e={}))ad.call(e,t)&&Ys(i,t,e[t]);if(Js)for(var t of Js(e))cd.call(e,t)&&Ys(i,t,e[t]);return i};class ui extends Oa{constructor(e,t,s,r=ft,n=void 0){super(e,t,s,r),this.core=e,this.logger=t,this.name=s,this.map=new Map,this.version=Rf,this.cached=[],this.initialized=!1,this.storagePrefix=ft,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(a=>{this.getKey&&a!==null&&!ht(a)?this.map.set(this.getKey(a),a):an(a)?this.map.set(a.id,a):cn(a)&&this.map.set(a.topic,a)}),this.cached=[],this.initialized=!0)},this.set=async(a,u)=>{this.isInitialized(),this.map.has(a)?await this.update(a,u):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:a,value:u}),this.map.set(a,u),await this.persist())},this.get=a=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:a}),this.getData(a)),this.getAll=a=>(this.isInitialized(),a?this.values.filter(u=>Object.keys(a).every(l=>un(u[l],a[l]))):this.values),this.update=async(a,u)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:a,update:u});const l=Qs(Qs({},this.getData(a)),u);this.map.set(a,l),await this.persist()},this.delete=async(a,u)=>{this.isInitialized(),this.map.has(a)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:a,reason:u}),this.map.delete(a),await this.persist())},this.logger=k.generateChildLogger(t,this.name),this.storagePrefix=r,this.getKey=n}get context(){return k.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const t=this.map.get(e);if(!t){const{message:s}=P("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(s),new Error(s)}return t}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:t}=P("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=P("NOT_INITIALIZED",this.name);throw new Error(e)}}}class ud{constructor(e,t){this.core=e,this.logger=t,this.name=Lf,this.version=Mf,this.events=new ur,this.initialized=!1,this.storagePrefix=ft,this.ignoredPayloadTypes=[lr],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:s})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...s])]},this.create=async()=>{this.isInitialized();const s=Pi(),r=await this.core.crypto.setSymKey(s),n=We(j.FIVE_MINUTES),a={protocol:Zr},u={topic:r,expiry:n,relay:a,active:!1},l=vn({protocol:this.core.protocol,version:this.core.version,topic:r,symKey:s,relay:a});return await this.pairings.set(r,u),await this.core.relayer.subscribe(r),this.core.expirer.set(r,n),{topic:r,uri:l}},this.pair=async s=>{this.isInitialized(),this.isValidPair(s);const{topic:r,symKey:n,relay:a}=os(s.uri);let u;if(this.pairings.keys.includes(r)&&(u=this.pairings.get(r),u.active))throw new Error(`Pairing already exists: ${r}. Please try again with a new connection URI.`);const l=We(j.FIVE_MINUTES),c={topic:r,relay:a,expiry:l,active:!1};return await this.pairings.set(r,c),this.core.expirer.set(r,l),s.activatePairing&&await this.activate({topic:r}),this.events.emit(Mt.create,c),this.core.crypto.keychain.has(r)||(await this.core.crypto.setSymKey(n,r),await this.core.relayer.subscribe(r,{relay:a})),c},this.activate=async({topic:s})=>{this.isInitialized();const r=We(j.THIRTY_DAYS);await this.pairings.update(s,{active:!0,expiry:r}),this.core.expirer.set(s,r)},this.ping=async s=>{this.isInitialized(),await this.isValidPing(s);const{topic:r}=s;if(this.pairings.keys.includes(r)){const n=await this.sendRequest(r,"wc_pairingPing",{}),{done:a,resolve:u,reject:l}=Et();this.events.once(ie("pairing_ping",n),({error:c})=>{c?l(c):u()}),await a()}},this.updateExpiry=async({topic:s,expiry:r})=>{this.isInitialized(),await this.pairings.update(s,{expiry:r})},this.updateMetadata=async({topic:s,metadata:r})=>{this.isInitialized(),await this.pairings.update(s,{peerMetadata:r})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async s=>{this.isInitialized(),await this.isValidDisconnect(s);const{topic:r}=s;this.pairings.keys.includes(r)&&(await this.sendRequest(r,"wc_pairingDelete",Re("USER_DISCONNECTED")),await this.deletePairing(r))},this.sendRequest=async(s,r,n)=>{const a=It(r,n),u=await this.core.crypto.encode(s,a),l=Tt[r].req;return this.core.history.set(s,a),this.core.relayer.publish(s,u,l),a.id},this.sendResult=async(s,r,n)=>{const a=Ji(s,n),u=await this.core.crypto.encode(r,a),l=await this.core.history.get(r,s),c=Tt[l.request.method].res;await this.core.relayer.publish(r,u,c),await this.core.history.resolve(a)},this.sendError=async(s,r,n)=>{const a=Yi(s,n),u=await this.core.crypto.encode(r,a),l=await this.core.history.get(r,s),c=Tt[l.request.method]?Tt[l.request.method].res:Tt.unregistered_method.res;await this.core.relayer.publish(r,u,c),await this.core.history.resolve(a)},this.deletePairing=async(s,r)=>{await this.core.relayer.unsubscribe(s),await Promise.all([this.pairings.delete(s,Re("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(s),r?Promise.resolve():this.core.expirer.del(s)])},this.cleanup=async()=>{const s=this.pairings.getAll().filter(r=>lt(r.expiry));await Promise.all(s.map(r=>this.deletePairing(r.topic)))},this.onRelayEventRequest=s=>{const{topic:r,payload:n}=s;switch(n.method){case"wc_pairingPing":return this.onPairingPingRequest(r,n);case"wc_pairingDelete":return this.onPairingDeleteRequest(r,n);default:return this.onUnknownRpcMethodRequest(r,n)}},this.onRelayEventResponse=async s=>{const{topic:r,payload:n}=s,a=(await this.core.history.get(r,n.id)).request.method;switch(a){case"wc_pairingPing":return this.onPairingPingResponse(r,n);default:return this.onUnknownRpcMethodResponse(a)}},this.onPairingPingRequest=async(s,r)=>{const{id:n}=r;try{this.isValidPing({topic:s}),await this.sendResult(n,s,!0),this.events.emit(Mt.ping,{id:n,topic:s})}catch(a){await this.sendError(n,s,a),this.logger.error(a)}},this.onPairingPingResponse=(s,r)=>{const{id:n}=r;setTimeout(()=>{ot(r)?this.events.emit(ie("pairing_ping",n),{}):Je(r)&&this.events.emit(ie("pairing_ping",n),{error:r.error})},500)},this.onPairingDeleteRequest=async(s,r)=>{const{id:n}=r;try{this.isValidDisconnect({topic:s}),await this.deletePairing(s),this.events.emit(Mt.delete,{id:n,topic:s})}catch(a){await this.sendError(n,s,a),this.logger.error(a)}},this.onUnknownRpcMethodRequest=async(s,r)=>{const{id:n,method:a}=r;try{if(this.registeredMethods.includes(a))return;const u=Re("WC_METHOD_UNSUPPORTED",a);await this.sendError(n,s,u),this.logger.error(u)}catch(u){await this.sendError(n,s,u),this.logger.error(u)}},this.onUnknownRpcMethodResponse=s=>{this.registeredMethods.includes(s)||this.logger.error(Re("WC_METHOD_UNSUPPORTED",s))},this.isValidPair=s=>{var r;if(!qe(s)){const{message:a}=P("MISSING_OR_INVALID",`pair() params: ${s}`);throw new Error(a)}if(!En(s.uri)){const{message:a}=P("MISSING_OR_INVALID",`pair() uri: ${s.uri}`);throw new Error(a)}const n=os(s.uri);if(!((r=n==null?void 0:n.relay)!=null&&r.protocol)){const{message:a}=P("MISSING_OR_INVALID","pair() uri#relay-protocol");throw new Error(a)}if(!(n!=null&&n.symKey)){const{message:a}=P("MISSING_OR_INVALID","pair() uri#symKey");throw new Error(a)}},this.isValidPing=async s=>{if(!qe(s)){const{message:n}=P("MISSING_OR_INVALID",`ping() params: ${s}`);throw new Error(n)}const{topic:r}=s;await this.isValidPairingTopic(r)},this.isValidDisconnect=async s=>{if(!qe(s)){const{message:n}=P("MISSING_OR_INVALID",`disconnect() params: ${s}`);throw new Error(n)}const{topic:r}=s;await this.isValidPairingTopic(r)},this.isValidPairingTopic=async s=>{if(!_t(s,!1)){const{message:r}=P("MISSING_OR_INVALID",`pairing topic should be a string: ${s}`);throw new Error(r)}if(!this.pairings.keys.includes(s)){const{message:r}=P("NO_MATCHING_KEY",`pairing topic doesn't exist: ${s}`);throw new Error(r)}if(lt(this.pairings.get(s).expiry)){await this.deletePairing(s);const{message:r}=P("EXPIRED",`pairing topic: ${s}`);throw new Error(r)}},this.core=e,this.logger=k.generateChildLogger(t,this.name),this.pairings=new ui(this.core,this.logger,this.name,this.storagePrefix)}get context(){return k.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=P("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(Ae.message,async e=>{const{topic:t,message:s}=e;if(!this.pairings.keys.includes(t)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(s)))return;const r=await this.core.crypto.decode(t,s);try{Qi(r)?(this.core.history.set(t,r),this.onRelayEventRequest({topic:t,payload:r})):ai(r)&&(await this.core.history.resolve(r),await this.onRelayEventResponse({topic:t,payload:r}),this.core.history.delete(t,r.id))}catch(n){this.logger.error(n)}})}registerExpirerEvents(){this.core.expirer.on(Ve.expired,async e=>{const{topic:t}=hr(e.target);t&&this.pairings.keys.includes(t)&&(await this.deletePairing(t,!0),this.events.emit(Mt.expire,{topic:t}))})}}class ld extends Sa{constructor(e,t){super(e,t),this.core=e,this.logger=t,this.records=new Map,this.events=new Ze.EventEmitter,this.name=jf,this.version=zf,this.cached=[],this.initialized=!1,this.storagePrefix=ft,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.records.set(s.id,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(s,r,n)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:s,request:r,chainId:n}),this.records.has(r.id))return;const a={id:r.id,topic:s,request:{method:r.method,params:r.params||null},chainId:n,expiry:We(j.THIRTY_DAYS)};this.records.set(a.id,a),this.events.emit(Xe.created,a)},this.resolve=async s=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:s}),!this.records.has(s.id))return;const r=await this.getRecord(s.id);typeof r.response>"u"&&(r.response=Je(s)?{error:s.error}:{result:s.result},this.records.set(r.id,r),this.events.emit(Xe.updated,r))},this.get=async(s,r)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:s,id:r}),await this.getRecord(r)),this.delete=(s,r)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:r}),this.values.forEach(n=>{if(n.topic===s){if(typeof r<"u"&&n.id!==r)return;this.records.delete(n.id),this.events.emit(Xe.deleted,n)}})},this.exists=async(s,r)=>(this.isInitialized(),this.records.has(r)?(await this.getRecord(r)).topic===s:!1),this.on=(s,r)=>{this.events.on(s,r)},this.once=(s,r)=>{this.events.once(s,r)},this.off=(s,r)=>{this.events.off(s,r)},this.removeListener=(s,r)=>{this.events.removeListener(s,r)},this.logger=k.generateChildLogger(t,this.name)}get context(){return k.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(t=>{if(typeof t.response<"u")return;const s={topic:t.topic,request:It(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(s)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const t=this.records.get(e);if(!t){const{message:s}=P("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(s)}return t}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Xe.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:t}=P("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(Xe.created,e=>{const t=Xe.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e}),this.persist()}),this.events.on(Xe.updated,e=>{const t=Xe.updated;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e}),this.persist()}),this.events.on(Xe.deleted,e=>{const t=Xe.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e}),this.persist()}),this.core.heartbeat.on(Ct.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(e=>{j.toMiliseconds(e.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${e.id}`),this.delete(e.topic,e.id))})}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=P("NOT_INITIALIZED",this.name);throw new Error(e)}}}class hd extends Aa{constructor(e,t){super(e,t),this.core=e,this.logger=t,this.expirations=new Map,this.events=new Ze.EventEmitter,this.name=qf,this.version=Uf,this.cached=[],this.initialized=!1,this.storagePrefix=ft,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.expirations.set(s.target,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=s=>{try{const r=this.formatTarget(s);return typeof this.getExpiration(r)<"u"}catch{return!1}},this.set=(s,r)=>{this.isInitialized();const n=this.formatTarget(s),a={target:n,expiry:r};this.expirations.set(n,a),this.checkExpiry(n,a),this.events.emit(Ve.created,{target:n,expiration:a})},this.get=s=>{this.isInitialized();const r=this.formatTarget(s);return this.getExpiration(r)},this.del=s=>{if(this.isInitialized(),this.has(s)){const r=this.formatTarget(s),n=this.getExpiration(r);this.expirations.delete(r),this.events.emit(Ve.deleted,{target:r,expiration:n})}},this.on=(s,r)=>{this.events.on(s,r)},this.once=(s,r)=>{this.events.once(s,r)},this.off=(s,r)=>{this.events.off(s,r)},this.removeListener=(s,r)=>{this.events.removeListener(s,r)},this.logger=k.generateChildLogger(t,this.name)}get context(){return k.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return _n(e);if(typeof e=="number")return xn(e);const{message:t}=P("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(t)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Ve.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:t}=P("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const t=this.expirations.get(e);if(!t){const{message:s}=P("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(s),new Error(s)}return t}checkExpiry(e,t){const{expiry:s}=t;j.toMiliseconds(s)-Date.now()<=0&&this.expire(e,t)}expire(e,t){this.expirations.delete(e),this.events.emit(Ve.expired,{target:e,expiration:t})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,t)=>this.checkExpiry(t,e))}registerEventListeners(){this.core.heartbeat.on(Ct.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(Ve.created,e=>{const t=Ve.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(Ve.expired,e=>{const t=Ve.expired;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(Ve.deleted,e=>{const t=Ve.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=P("NOT_INITIALIZED",this.name);throw new Error(e)}}}class fd extends Ta{constructor(e,t){super(e,t),this.projectId=e,this.logger=t,this.name=xi,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async s=>{if(this.verifyDisabled||Sn()||!fr())return;const r=this.getVerifyUrl(s==null?void 0:s.verifyUrl);this.verifyUrl!==r&&this.removeIframe(),this.verifyUrl=r;try{await this.createIframe()}catch(n){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(n)}if(!this.initialized){this.removeIframe(),this.verifyUrl=ki;try{await this.createIframe()}catch(n){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(n),this.verifyDisabled=!0}}},this.register=async s=>{this.initialized?this.sendPost(s.attestationId):(this.addToQueue(s.attestationId),await this.init())},this.resolve=async s=>{if(this.isDevEnv)return"";const r=this.getVerifyUrl(s==null?void 0:s.verifyUrl);let n;try{n=await this.fetchAttestation(s.attestationId,r)}catch(a){this.logger.info(`failed to resolve attestation: ${s.attestationId} from url: ${r}`),this.logger.info(a),n=await this.fetchAttestation(s.attestationId,ki)}return n},this.fetchAttestation=async(s,r)=>{this.logger.info(`resolving attestation: ${s} from url: ${r}`);const n=this.startAbortTimer(j.ONE_SECOND*2),a=await fetch(`${r}/attestation/${s}`,{signal:this.abortController.signal});return clearTimeout(n),a.status===200?await a.json():void 0},this.addToQueue=s=>{this.queue.push(s)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(s=>this.sendPost(s)),this.queue=[])},this.sendPost=s=>{var r;try{if(!this.iframe)return;(r=this.iframe.contentWindow)==null||r.postMessage(s,"*"),this.logger.info(`postMessage sent: ${s} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let s;const r=n=>{n.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",r),s())};await Promise.race([new Promise(n=>{if(document.getElementById(xi))return n();window.addEventListener("message",r);const a=document.createElement("iframe");a.id=xi,a.src=`${this.verifyUrl}/${this.projectId}`,a.style.display="none",document.body.append(a),this.iframe=a,s=n}),new Promise((n,a)=>setTimeout(()=>{window.removeEventListener("message",r),a("verify iframe load timeout")},j.toMiliseconds(j.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=s=>{let r=s||xt;return Ff.includes(r)||(this.logger.info(`verify url: ${r}, not included in trusted list, assigning default: ${xt}`),r=xt),r},this.logger=k.generateChildLogger(t,this.name),this.verifyUrl=xt,this.abortController=new AbortController,this.isDevEnv=In()&&Fl.IS_VITEST}get context(){return k.getLoggerContext(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),j.toMiliseconds(e))}}class dd extends Na{constructor(e,t){super(e,t),this.projectId=e,this.logger=t,this.context=kf,this.registerDeviceToken=async s=>{const{clientId:r,token:n,notificationType:a,enableEncrypted:u=!1}=s,l=`${Bf}/${this.projectId}/clients`;await Ul(l,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:r,type:a,token:n,always_raw:u})})},this.logger=k.generateChildLogger(t,this.context)}}var pd=Object.defineProperty,Xs=Object.getOwnPropertySymbols,gd=Object.prototype.hasOwnProperty,yd=Object.prototype.propertyIsEnumerable,Zs=(i,e,t)=>e in i?pd(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,er=(i,e)=>{for(var t in e||(e={}))gd.call(e,t)&&Zs(i,t,e[t]);if(Xs)for(var t of Xs(e))yd.call(e,t)&&Zs(i,t,e[t]);return i};class Zi extends xa{constructor(e){super(e),this.protocol=Xr,this.version=df,this.name=Xi,this.events=new Ze.EventEmitter,this.initialized=!1,this.on=(s,r)=>this.events.on(s,r),this.once=(s,r)=>this.events.once(s,r),this.off=(s,r)=>this.events.off(s,r),this.removeListener=(s,r)=>this.events.removeListener(s,r),this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||en,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const t=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:k.pino(k.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||pf.logger}));this.logger=k.generateChildLogger(t,this.name),this.heartbeat=new Ct.HeartBeat,this.crypto=new Kf(this,this.logger,e==null?void 0:e.keychain),this.history=new ld(this,this.logger),this.expirer=new hd(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new Po(er(er({},gf),e==null?void 0:e.storageOptions)),this.relayer=new nd({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new ud(this,this.logger),this.verify=new fd(this.projectId||"",this.logger),this.echoClient=new dd(this.projectId||"",this.logger)}static async init(e){const t=new Zi(e);await t.initialize();const s=await t.crypto.getClientId();return await t.storage.setItem(Af,s),t}get context(){return k.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}}const Dd=Zi,tn="wc",sn=2,rn="client",es=`${tn}@${sn}:${rn}:`,Ii={name:rn,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},tr="WALLETCONNECT_DEEPLINK_CHOICE",bd="proposal",md="Proposal expired",wd="session",Xt=j.SEVEN_DAYS,vd="engine",$t={wc_sessionPropose:{req:{ttl:j.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:j.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:j.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:j.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:j.ONE_DAY,prompt:!1,tag:1104},res:{ttl:j.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:j.ONE_DAY,prompt:!1,tag:1106},res:{ttl:j.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:j.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:j.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:j.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:j.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:j.ONE_DAY,prompt:!1,tag:1112},res:{ttl:j.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:j.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:j.THIRTY_SECONDS,prompt:!1,tag:1115}}},Ci={min:j.FIVE_MINUTES,max:j.SEVEN_DAYS},nt={idle:"IDLE",active:"ACTIVE"},Ed="request",_d=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var xd=Object.defineProperty,Sd=Object.defineProperties,Id=Object.getOwnPropertyDescriptors,ir=Object.getOwnPropertySymbols,Cd=Object.prototype.hasOwnProperty,Pd=Object.prototype.propertyIsEnumerable,sr=(i,e,t)=>e in i?xd(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,je=(i,e)=>{for(var t in e||(e={}))Cd.call(e,t)&&sr(i,t,e[t]);if(ir)for(var t of ir(e))Pd.call(e,t)&&sr(i,t,e[t]);return i},Lt=(i,e)=>Sd(i,Id(e));class Od extends La{constructor(e){super(e),this.name=vd,this.events=new ur,this.initialized=!1,this.ignoredPayloadTypes=[lr],this.requestQueue={state:nt.idle,queue:[]},this.sessionRequestQueue={state:nt.idle,queue:[]},this.requestQueueDelay=j.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys($t)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},j.toMiliseconds(this.requestQueueDelay)))},this.connect=async t=>{await this.isInitialized();const s=Lt(je({},t),{requiredNamespaces:t.requiredNamespaces||{},optionalNamespaces:t.optionalNamespaces||{}});await this.isValidConnect(s);const{pairingTopic:r,requiredNamespaces:n,optionalNamespaces:a,sessionProperties:u,relays:l}=s;let c=r,h,g=!1;if(c&&(g=this.client.core.pairing.pairings.get(c).active),!c||!g){const{topic:L,uri:R}=await this.client.core.pairing.create();c=L,h=R}const d=await this.client.core.crypto.generateKeyPair(),v=je({requiredNamespaces:n,optionalNamespaces:a,relays:l??[{protocol:Zr}],proposer:{publicKey:d,metadata:this.client.metadata}},u&&{sessionProperties:u}),{reject:p,resolve:_,done:$}=Et(j.FIVE_MINUTES,md);if(this.events.once(ie("session_connect"),async({error:L,session:R})=>{if(L)p(L);else if(R){R.self.publicKey=d;const z=Lt(je({},R),{requiredNamespaces:R.requiredNamespaces,optionalNamespaces:R.optionalNamespaces});await this.client.session.set(R.topic,z),await this.setExpiry(R.topic,R.expiry),c&&await this.client.core.pairing.updateMetadata({topic:c,metadata:R.peer.metadata}),_(z)}}),!c){const{message:L}=P("NO_MATCHING_KEY",`connect() pairing topic: ${c}`);throw new Error(L)}const A=await this.sendRequest({topic:c,method:"wc_sessionPropose",params:v}),N=We(j.FIVE_MINUTES);return await this.setProposal(A,je({id:A,expiry:N},v)),{uri:h,approval:$}},this.pair=async t=>(await this.isInitialized(),await this.client.core.pairing.pair(t)),this.approve=async t=>{await this.isInitialized(),await this.isValidApprove(t);const{id:s,relayProtocol:r,namespaces:n,sessionProperties:a}=t,u=this.client.proposal.get(s);let{pairingTopic:l,proposer:c,requiredNamespaces:h,optionalNamespaces:g}=u;l=l||"",hi(h)||(h=On(n,"approve()"));const d=await this.client.core.crypto.generateKeyPair(),v=c.publicKey,p=await this.client.core.crypto.generateSharedKey(d,v);l&&s&&(await this.client.core.pairing.updateMetadata({topic:l,metadata:c.metadata}),await this.sendResult({id:s,topic:l,result:{relay:{protocol:r??"irn"},responderPublicKey:d}}),await this.client.proposal.delete(s,Re("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:l}));const _=je({relay:{protocol:r??"irn"},namespaces:n,requiredNamespaces:h,optionalNamespaces:g,pairingTopic:l,controller:{publicKey:d,metadata:this.client.metadata},expiry:We(Xt)},a&&{sessionProperties:a});await this.client.core.relayer.subscribe(p),await this.sendRequest({topic:p,method:"wc_sessionSettle",params:_,throwOnFailedPublish:!0});const $=Lt(je({},_),{topic:p,pairingTopic:l,acknowledged:!1,self:_.controller,peer:{publicKey:c.publicKey,metadata:c.metadata},controller:d});return await this.client.session.set(p,$),await this.setExpiry(p,We(Xt)),{topic:p,acknowledged:()=>new Promise(A=>setTimeout(()=>A(this.client.session.get(p)),500))}},this.reject=async t=>{await this.isInitialized(),await this.isValidReject(t);const{id:s,reason:r}=t,{pairingTopic:n}=this.client.proposal.get(s);n&&(await this.sendError(s,n,r),await this.client.proposal.delete(s,Re("USER_DISCONNECTED")))},this.update=async t=>{await this.isInitialized(),await this.isValidUpdate(t);const{topic:s,namespaces:r}=t,n=await this.sendRequest({topic:s,method:"wc_sessionUpdate",params:{namespaces:r}}),{done:a,resolve:u,reject:l}=Et();return this.events.once(ie("session_update",n),({error:c})=>{c?l(c):u()}),await this.client.session.update(s,{namespaces:r}),{acknowledged:a}},this.extend=async t=>{await this.isInitialized(),await this.isValidExtend(t);const{topic:s}=t,r=await this.sendRequest({topic:s,method:"wc_sessionExtend",params:{}}),{done:n,resolve:a,reject:u}=Et();return this.events.once(ie("session_extend",r),({error:l})=>{l?u(l):a()}),await this.setExpiry(s,We(Xt)),{acknowledged:n}},this.request=async t=>{await this.isInitialized(),await this.isValidRequest(t);const{chainId:s,request:r,topic:n,expiry:a}=t,u=Wi(),{done:l,resolve:c,reject:h}=Et(a,"Request expired. Please try again.");return this.events.once(ie("session_request",u),({error:g,result:d})=>{g?h(g):c(d)}),await Promise.all([new Promise(async g=>{await this.sendRequest({clientRpcId:u,topic:n,method:"wc_sessionRequest",params:{request:r,chainId:s},expiry:a,throwOnFailedPublish:!0}).catch(d=>h(d)),this.client.events.emit("session_request_sent",{topic:n,request:r,chainId:s,id:u}),g()}),new Promise(async g=>{const d=await Rn(this.client.core.storage,tr);An({id:u,topic:n,wcDeepLink:d}),g()}),l()]).then(g=>g[2])},this.respond=async t=>{await this.isInitialized(),await this.isValidRespond(t);const{topic:s,response:r}=t,{id:n}=r;ot(r)?await this.sendResult({id:n,topic:s,result:r.result,throwOnFailedPublish:!0}):Je(r)&&await this.sendError(n,s,r.error),this.cleanupAfterResponse(t)},this.ping=async t=>{await this.isInitialized(),await this.isValidPing(t);const{topic:s}=t;if(this.client.session.keys.includes(s)){const r=await this.sendRequest({topic:s,method:"wc_sessionPing",params:{}}),{done:n,resolve:a,reject:u}=Et();this.events.once(ie("session_ping",r),({error:l})=>{l?u(l):a()}),await n()}else this.client.core.pairing.pairings.keys.includes(s)&&await this.client.core.pairing.ping({topic:s})},this.emit=async t=>{await this.isInitialized(),await this.isValidEmit(t);const{topic:s,event:r,chainId:n}=t;await this.sendRequest({topic:s,method:"wc_sessionEvent",params:{event:r,chainId:n}})},this.disconnect=async t=>{await this.isInitialized(),await this.isValidDisconnect(t);const{topic:s}=t;this.client.session.keys.includes(s)?(await this.sendRequest({topic:s,method:"wc_sessionDelete",params:Re("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(s)):await this.client.core.pairing.disconnect({topic:s})},this.find=t=>(this.isInitialized(),this.client.session.getAll().filter(s=>Tn(s,t))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async t=>{if(t.pairingTopic)try{const s=this.client.core.pairing.pairings.get(t.pairingTopic),r=this.client.core.pairing.pairings.getAll().filter(n=>{var a,u;return((a=n.peerMetadata)==null?void 0:a.url)&&((u=n.peerMetadata)==null?void 0:u.url)===t.peer.metadata.url&&n.topic&&n.topic!==s.topic});if(r.length===0)return;this.client.logger.info(`Cleaning up ${r.length} duplicate pairing(s)`),await Promise.all(r.map(n=>this.client.core.pairing.disconnect({topic:n.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(s){this.client.logger.error(s)}},this.deleteSession=async(t,s)=>{const{self:r}=this.client.session.get(t);await this.client.core.relayer.unsubscribe(t),this.client.session.delete(t,Re("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(r.publicKey)&&await this.client.core.crypto.deleteKeyPair(r.publicKey),this.client.core.crypto.keychain.has(t)&&await this.client.core.crypto.deleteSymKey(t),s||this.client.core.expirer.del(t),this.client.core.storage.removeItem(tr).catch(n=>this.client.logger.warn(n)),this.getPendingSessionRequests().forEach(n=>{n.topic===t&&this.deletePendingSessionRequest(n.id,Re("USER_DISCONNECTED"))})},this.deleteProposal=async(t,s)=>{await Promise.all([this.client.proposal.delete(t,Re("USER_DISCONNECTED")),s?Promise.resolve():this.client.core.expirer.del(t)])},this.deletePendingSessionRequest=async(t,s,r=!1)=>{await Promise.all([this.client.pendingRequest.delete(t,s),r?Promise.resolve():this.client.core.expirer.del(t)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(n=>n.id!==t),r&&(this.sessionRequestQueue.state=nt.idle)},this.setExpiry=async(t,s)=>{this.client.session.keys.includes(t)&&await this.client.session.update(t,{expiry:s}),this.client.core.expirer.set(t,s)},this.setProposal=async(t,s)=>{await this.client.proposal.set(t,s),this.client.core.expirer.set(t,s.expiry)},this.setPendingSessionRequest=async t=>{const s=$t.wc_sessionRequest.req.ttl,{id:r,topic:n,params:a,verifyContext:u}=t;await this.client.pendingRequest.set(r,{id:r,topic:n,params:a,verifyContext:u}),s&&this.client.core.expirer.set(r,We(s))},this.sendRequest=async t=>{const{topic:s,method:r,params:n,expiry:a,relayRpcId:u,clientRpcId:l,throwOnFailedPublish:c}=t,h=It(r,n,l);if(fr()&&_d.includes(r)){const v=St(JSON.stringify(h));this.client.core.verify.register({attestationId:v})}const g=await this.client.core.crypto.encode(s,h),d=$t[r].req;return a&&(d.ttl=a),u&&(d.id=u),this.client.core.history.set(s,h),c?(d.internal=Lt(je({},d.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,g,d)):this.client.core.relayer.publish(s,g,d).catch(v=>this.client.logger.error(v)),h.id},this.sendResult=async t=>{const{id:s,topic:r,result:n,throwOnFailedPublish:a}=t,u=Ji(s,n),l=await this.client.core.crypto.encode(r,u),c=await this.client.core.history.get(r,s),h=$t[c.request.method].res;a?(h.internal=Lt(je({},h.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(r,l,h)):this.client.core.relayer.publish(r,l,h).catch(g=>this.client.logger.error(g)),await this.client.core.history.resolve(u)},this.sendError=async(t,s,r)=>{const n=Yi(t,r),a=await this.client.core.crypto.encode(s,n),u=await this.client.core.history.get(s,t),l=$t[u.request.method].res;this.client.core.relayer.publish(s,a,l),await this.client.core.history.resolve(n)},this.cleanup=async()=>{const t=[],s=[];this.client.session.getAll().forEach(r=>{lt(r.expiry)&&t.push(r.topic)}),this.client.proposal.getAll().forEach(r=>{lt(r.expiry)&&s.push(r.id)}),await Promise.all([...t.map(r=>this.deleteSession(r)),...s.map(r=>this.deleteProposal(r))])},this.onRelayEventRequest=async t=>{this.requestQueue.queue.push(t),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===nt.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=nt.active;const t=this.requestQueue.queue.shift();if(t)try{this.processRequest(t),await new Promise(s=>setTimeout(s,300))}catch(s){this.client.logger.warn(s)}}this.requestQueue.state=nt.idle},this.processRequest=t=>{const{topic:s,payload:r}=t,n=r.method;switch(n){case"wc_sessionPropose":return this.onSessionProposeRequest(s,r);case"wc_sessionSettle":return this.onSessionSettleRequest(s,r);case"wc_sessionUpdate":return this.onSessionUpdateRequest(s,r);case"wc_sessionExtend":return this.onSessionExtendRequest(s,r);case"wc_sessionPing":return this.onSessionPingRequest(s,r);case"wc_sessionDelete":return this.onSessionDeleteRequest(s,r);case"wc_sessionRequest":return this.onSessionRequest(s,r);case"wc_sessionEvent":return this.onSessionEventRequest(s,r);default:return this.client.logger.info(`Unsupported request method ${n}`)}},this.onRelayEventResponse=async t=>{const{topic:s,payload:r}=t,n=(await this.client.core.history.get(s,r.id)).request.method;switch(n){case"wc_sessionPropose":return this.onSessionProposeResponse(s,r);case"wc_sessionSettle":return this.onSessionSettleResponse(s,r);case"wc_sessionUpdate":return this.onSessionUpdateResponse(s,r);case"wc_sessionExtend":return this.onSessionExtendResponse(s,r);case"wc_sessionPing":return this.onSessionPingResponse(s,r);case"wc_sessionRequest":return this.onSessionRequestResponse(s,r);default:return this.client.logger.info(`Unsupported response method ${n}`)}},this.onRelayEventUnknownPayload=t=>{const{topic:s}=t,{message:r}=P("MISSING_OR_INVALID",`Decoded payload on topic ${s} is not identifiable as a JSON-RPC request or a response.`);throw new Error(r)},this.onSessionProposeRequest=async(t,s)=>{const{params:r,id:n}=s;try{this.isValidConnect(je({},s.params));const a=We(j.FIVE_MINUTES),u=je({id:n,pairingTopic:t,expiry:a},r);await this.setProposal(n,u);const l=St(JSON.stringify(s)),c=await this.getVerifyContext(l,u.proposer.metadata);this.client.events.emit("session_proposal",{id:n,params:u,verifyContext:c})}catch(a){await this.sendError(n,t,a),this.client.logger.error(a)}},this.onSessionProposeResponse=async(t,s)=>{const{id:r}=s;if(ot(s)){const{result:n}=s;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:n});const a=this.client.proposal.get(r);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});const u=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:u});const l=n.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:l});const c=await this.client.core.crypto.generateSharedKey(u,l);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:c});const h=await this.client.core.relayer.subscribe(c);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:h}),await this.client.core.pairing.activate({topic:t})}else Je(s)&&(await this.client.proposal.delete(r,Re("USER_DISCONNECTED")),this.events.emit(ie("session_connect"),{error:s.error}))},this.onSessionSettleRequest=async(t,s)=>{const{id:r,params:n}=s;try{this.isValidSessionSettleRequest(n);const{relay:a,controller:u,expiry:l,namespaces:c,requiredNamespaces:h,optionalNamespaces:g,sessionProperties:d,pairingTopic:v}=s.params,p=je({topic:t,relay:a,expiry:l,namespaces:c,acknowledged:!0,pairingTopic:v,requiredNamespaces:h,optionalNamespaces:g,controller:u.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:u.publicKey,metadata:u.metadata}},d&&{sessionProperties:d});await this.sendResult({id:s.id,topic:t,result:!0}),this.events.emit(ie("session_connect"),{session:p}),this.cleanupDuplicatePairings(p)}catch(a){await this.sendError(r,t,a),this.client.logger.error(a)}},this.onSessionSettleResponse=async(t,s)=>{const{id:r}=s;ot(s)?(await this.client.session.update(t,{acknowledged:!0}),this.events.emit(ie("session_approve",r),{})):Je(s)&&(await this.client.session.delete(t,Re("USER_DISCONNECTED")),this.events.emit(ie("session_approve",r),{error:s.error}))},this.onSessionUpdateRequest=async(t,s)=>{const{params:r,id:n}=s;try{const a=`${t}_session_update`,u=Jt.get(a);if(u&&this.isRequestOutOfSync(u,n)){this.client.logger.info(`Discarding out of sync request - ${n}`);return}this.isValidUpdate(je({topic:t},r)),await this.client.session.update(t,{namespaces:r.namespaces}),await this.sendResult({id:n,topic:t,result:!0}),this.client.events.emit("session_update",{id:n,topic:t,params:r}),Jt.set(a,n)}catch(a){await this.sendError(n,t,a),this.client.logger.error(a)}},this.isRequestOutOfSync=(t,s)=>parseInt(s.toString().slice(0,-3))<=parseInt(t.toString().slice(0,-3)),this.onSessionUpdateResponse=(t,s)=>{const{id:r}=s;ot(s)?this.events.emit(ie("session_update",r),{}):Je(s)&&this.events.emit(ie("session_update",r),{error:s.error})},this.onSessionExtendRequest=async(t,s)=>{const{id:r}=s;try{this.isValidExtend({topic:t}),await this.setExpiry(t,We(Xt)),await this.sendResult({id:r,topic:t,result:!0}),this.client.events.emit("session_extend",{id:r,topic:t})}catch(n){await this.sendError(r,t,n),this.client.logger.error(n)}},this.onSessionExtendResponse=(t,s)=>{const{id:r}=s;ot(s)?this.events.emit(ie("session_extend",r),{}):Je(s)&&this.events.emit(ie("session_extend",r),{error:s.error})},this.onSessionPingRequest=async(t,s)=>{const{id:r}=s;try{this.isValidPing({topic:t}),await this.sendResult({id:r,topic:t,result:!0}),this.client.events.emit("session_ping",{id:r,topic:t})}catch(n){await this.sendError(r,t,n),this.client.logger.error(n)}},this.onSessionPingResponse=(t,s)=>{const{id:r}=s;setTimeout(()=>{ot(s)?this.events.emit(ie("session_ping",r),{}):Je(s)&&this.events.emit(ie("session_ping",r),{error:s.error})},500)},this.onSessionDeleteRequest=async(t,s)=>{const{id:r}=s;try{this.isValidDisconnect({topic:t,reason:s.params}),await Promise.all([new Promise(n=>{this.client.core.relayer.once(Ae.publish,async()=>{n(await this.deleteSession(t))})}),this.sendResult({id:r,topic:t,result:!0})]),this.client.events.emit("session_delete",{id:r,topic:t})}catch(n){this.client.logger.error(n)}},this.onSessionRequest=async(t,s)=>{const{id:r,params:n}=s;try{this.isValidRequest(je({topic:t},n));const a=St(JSON.stringify(It("wc_sessionRequest",n,r))),u=this.client.session.get(t),l=await this.getVerifyContext(a,u.peer.metadata),c={id:r,topic:t,params:n,verifyContext:l};await this.setPendingSessionRequest(c),this.addSessionRequestToSessionRequestQueue(c),this.processSessionRequestQueue()}catch(a){await this.sendError(r,t,a),this.client.logger.error(a)}},this.onSessionRequestResponse=(t,s)=>{const{id:r}=s;ot(s)?this.events.emit(ie("session_request",r),{result:s.result}):Je(s)&&this.events.emit(ie("session_request",r),{error:s.error})},this.onSessionEventRequest=async(t,s)=>{const{id:r,params:n}=s;try{const a=`${t}_session_event_${n.event.name}`,u=Jt.get(a);if(u&&this.isRequestOutOfSync(u,r)){this.client.logger.info(`Discarding out of sync request - ${r}`);return}this.isValidEmit(je({topic:t},n)),this.client.events.emit("session_event",{id:r,topic:t,params:n}),Jt.set(a,r)}catch(a){await this.sendError(r,t,a),this.client.logger.error(a)}},this.addSessionRequestToSessionRequestQueue=t=>{this.sessionRequestQueue.queue.push(t)},this.cleanupAfterResponse=t=>{this.deletePendingSessionRequest(t.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=nt.idle,this.processSessionRequestQueue()},j.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===nt.active){this.client.logger.info("session request queue is already active.");return}const t=this.sessionRequestQueue.queue[0];if(!t){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=nt.active,this.client.events.emit("session_request",t)}catch(s){this.client.logger.error(s)}},this.onPairingCreated=t=>{if(t.active)return;const s=this.client.proposal.getAll().find(r=>r.pairingTopic===t.topic);s&&this.onSessionProposeRequest(t.topic,It("wc_sessionPropose",{requiredNamespaces:s.requiredNamespaces,optionalNamespaces:s.optionalNamespaces,relays:s.relays,proposer:s.proposer,sessionProperties:s.sessionProperties},s.id))},this.isValidConnect=async t=>{if(!qe(t)){const{message:l}=P("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(t)}`);throw new Error(l)}const{pairingTopic:s,requiredNamespaces:r,optionalNamespaces:n,sessionProperties:a,relays:u}=t;if(ht(s)||await this.isValidPairingTopic(s),!Nn(u,!0)){const{message:l}=P("MISSING_OR_INVALID",`connect() relays: ${u}`);throw new Error(l)}!ht(r)&&hi(r)!==0&&this.validateNamespaces(r,"requiredNamespaces"),!ht(n)&&hi(n)!==0&&this.validateNamespaces(n,"optionalNamespaces"),ht(a)||this.validateSessionProps(a,"sessionProperties")},this.validateNamespaces=(t,s)=>{const r=$n(t,"connect()",s);if(r)throw new Error(r.message)},this.isValidApprove=async t=>{if(!qe(t))throw new Error(P("MISSING_OR_INVALID",`approve() params: ${t}`).message);const{id:s,namespaces:r,relayProtocol:n,sessionProperties:a}=t;await this.isValidProposalId(s);const u=this.client.proposal.get(s),l=fi(r,"approve()");if(l)throw new Error(l.message);const c=as(u.requiredNamespaces,r,"approve()");if(c)throw new Error(c.message);if(!_t(n,!0)){const{message:h}=P("MISSING_OR_INVALID",`approve() relayProtocol: ${n}`);throw new Error(h)}ht(a)||this.validateSessionProps(a,"sessionProperties")},this.isValidReject=async t=>{if(!qe(t)){const{message:n}=P("MISSING_OR_INVALID",`reject() params: ${t}`);throw new Error(n)}const{id:s,reason:r}=t;if(await this.isValidProposalId(s),!Ln(r)){const{message:n}=P("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(r)}`);throw new Error(n)}},this.isValidSessionSettleRequest=t=>{if(!qe(t)){const{message:c}=P("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${t}`);throw new Error(c)}const{relay:s,controller:r,namespaces:n,expiry:a}=t;if(!Mn(s)){const{message:c}=P("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(c)}const u=jn(r,"onSessionSettleRequest()");if(u)throw new Error(u.message);const l=fi(n,"onSessionSettleRequest()");if(l)throw new Error(l.message);if(lt(a)){const{message:c}=P("EXPIRED","onSessionSettleRequest()");throw new Error(c)}},this.isValidUpdate=async t=>{if(!qe(t)){const{message:l}=P("MISSING_OR_INVALID",`update() params: ${t}`);throw new Error(l)}const{topic:s,namespaces:r}=t;await this.isValidSessionTopic(s);const n=this.client.session.get(s),a=fi(r,"update()");if(a)throw new Error(a.message);const u=as(n.requiredNamespaces,r,"update()");if(u)throw new Error(u.message)},this.isValidExtend=async t=>{if(!qe(t)){const{message:r}=P("MISSING_OR_INVALID",`extend() params: ${t}`);throw new Error(r)}const{topic:s}=t;await this.isValidSessionTopic(s)},this.isValidRequest=async t=>{if(!qe(t)){const{message:l}=P("MISSING_OR_INVALID",`request() params: ${t}`);throw new Error(l)}const{topic:s,request:r,chainId:n,expiry:a}=t;await this.isValidSessionTopic(s);const{namespaces:u}=this.client.session.get(s);if(!cs(u,n)){const{message:l}=P("MISSING_OR_INVALID",`request() chainId: ${n}`);throw new Error(l)}if(!zn(r)){const{message:l}=P("MISSING_OR_INVALID",`request() ${JSON.stringify(r)}`);throw new Error(l)}if(!qn(u,n,r.method)){const{message:l}=P("MISSING_OR_INVALID",`request() method: ${r.method}`);throw new Error(l)}if(a&&!Un(a,Ci)){const{message:l}=P("MISSING_OR_INVALID",`request() expiry: ${a}. Expiry must be a number (in seconds) between ${Ci.min} and ${Ci.max}`);throw new Error(l)}},this.isValidRespond=async t=>{var s;if(!qe(t)){const{message:a}=P("MISSING_OR_INVALID",`respond() params: ${t}`);throw new Error(a)}const{topic:r,response:n}=t;try{await this.isValidSessionTopic(r)}catch(a){throw(s=t==null?void 0:t.response)!=null&&s.id&&this.cleanupAfterResponse(t),a}if(!Fn(n)){const{message:a}=P("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(n)}`);throw new Error(a)}},this.isValidPing=async t=>{if(!qe(t)){const{message:r}=P("MISSING_OR_INVALID",`ping() params: ${t}`);throw new Error(r)}const{topic:s}=t;await this.isValidSessionOrPairingTopic(s)},this.isValidEmit=async t=>{if(!qe(t)){const{message:u}=P("MISSING_OR_INVALID",`emit() params: ${t}`);throw new Error(u)}const{topic:s,event:r,chainId:n}=t;await this.isValidSessionTopic(s);const{namespaces:a}=this.client.session.get(s);if(!cs(a,n)){const{message:u}=P("MISSING_OR_INVALID",`emit() chainId: ${n}`);throw new Error(u)}if(!kn(r)){const{message:u}=P("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(r)}`);throw new Error(u)}if(!Bn(a,n,r.name)){const{message:u}=P("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(r)}`);throw new Error(u)}},this.isValidDisconnect=async t=>{if(!qe(t)){const{message:r}=P("MISSING_OR_INVALID",`disconnect() params: ${t}`);throw new Error(r)}const{topic:s}=t;await this.isValidSessionOrPairingTopic(s)},this.getVerifyContext=async(t,s)=>{const r={verified:{verifyUrl:s.verifyUrl||xt,validation:"UNKNOWN",origin:s.url||""}};try{const n=await this.client.core.verify.resolve({attestationId:t,verifyUrl:s.verifyUrl});n&&(r.verified.origin=n.origin,r.verified.isScam=n.isScam,r.verified.validation=n.origin===new URL(s.url).origin?"VALID":"INVALID")}catch(n){this.client.logger.info(n)}return this.client.logger.info(`Verify context: ${JSON.stringify(r)}`),r},this.validateSessionProps=(t,s)=>{Object.values(t).forEach(r=>{if(!_t(r,!1)){const{message:n}=P("MISSING_OR_INVALID",`${s} must be in Record<string, string> format. Received: ${JSON.stringify(r)}`);throw new Error(n)}})}}async isInitialized(){if(!this.initialized){const{message:e}=P("NOT_INITIALIZED",this.name);throw new Error(e)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Ae.message,async e=>{const{topic:t,message:s}=e;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(s)))return;const r=await this.client.core.crypto.decode(t,s);try{Qi(r)?(this.client.core.history.set(t,r),this.onRelayEventRequest({topic:t,payload:r})):ai(r)?(await this.client.core.history.resolve(r),await this.onRelayEventResponse({topic:t,payload:r}),this.client.core.history.delete(t,r.id)):this.onRelayEventUnknownPayload({topic:t,payload:r})}catch(n){this.client.logger.error(n)}})}registerExpirerEvents(){this.client.core.expirer.on(Ve.expired,async e=>{const{topic:t,id:s}=hr(e.target);if(s&&this.client.pendingRequest.keys.includes(s))return await this.deletePendingSessionRequest(s,P("EXPIRED"),!0);t?this.client.session.keys.includes(t)&&(await this.deleteSession(t,!0),this.client.events.emit("session_expire",{topic:t})):s&&(await this.deleteProposal(s,!0),this.client.events.emit("proposal_expire",{id:s}))})}registerPairingEvents(){this.client.core.pairing.events.on(Mt.create,e=>this.onPairingCreated(e))}isValidPairingTopic(e){if(!_t(e,!1)){const{message:t}=P("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(t)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:t}=P("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(t)}if(lt(this.client.core.pairing.pairings.get(e).expiry)){const{message:t}=P("EXPIRED",`pairing topic: ${e}`);throw new Error(t)}}async isValidSessionTopic(e){if(!_t(e,!1)){const{message:t}=P("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(t)}if(!this.client.session.keys.includes(e)){const{message:t}=P("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(t)}if(lt(this.client.session.get(e).expiry)){await this.deleteSession(e);const{message:t}=P("EXPIRED",`session topic: ${e}`);throw new Error(t)}}async isValidSessionOrPairingTopic(e){if(this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(_t(e,!1)){const{message:t}=P("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(t)}else{const{message:t}=P("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(t)}}async isValidProposalId(e){if(!Vn(e)){const{message:t}=P("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(t)}if(!this.client.proposal.keys.includes(e)){const{message:t}=P("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(t)}if(lt(this.client.proposal.get(e).expiry)){await this.deleteProposal(e);const{message:t}=P("EXPIRED",`proposal id: ${e}`);throw new Error(t)}}}class Rd extends ui{constructor(e,t){super(e,t,bd,es),this.core=e,this.logger=t}}class Ad extends ui{constructor(e,t){super(e,t,wd,es),this.core=e,this.logger=t}}class Td extends ui{constructor(e,t){super(e,t,Ed,es,s=>s.id),this.core=e,this.logger=t}}class ts extends $a{constructor(e){super(e),this.protocol=tn,this.version=sn,this.name=Ii.name,this.events=new Ze.EventEmitter,this.on=(s,r)=>this.events.on(s,r),this.once=(s,r)=>this.events.once(s,r),this.off=(s,r)=>this.events.off(s,r),this.removeListener=(s,r)=>this.events.removeListener(s,r),this.removeAllListeners=s=>this.events.removeAllListeners(s),this.connect=async s=>{try{return await this.engine.connect(s)}catch(r){throw this.logger.error(r.message),r}},this.pair=async s=>{try{return await this.engine.pair(s)}catch(r){throw this.logger.error(r.message),r}},this.approve=async s=>{try{return await this.engine.approve(s)}catch(r){throw this.logger.error(r.message),r}},this.reject=async s=>{try{return await this.engine.reject(s)}catch(r){throw this.logger.error(r.message),r}},this.update=async s=>{try{return await this.engine.update(s)}catch(r){throw this.logger.error(r.message),r}},this.extend=async s=>{try{return await this.engine.extend(s)}catch(r){throw this.logger.error(r.message),r}},this.request=async s=>{try{return await this.engine.request(s)}catch(r){throw this.logger.error(r.message),r}},this.respond=async s=>{try{return await this.engine.respond(s)}catch(r){throw this.logger.error(r.message),r}},this.ping=async s=>{try{return await this.engine.ping(s)}catch(r){throw this.logger.error(r.message),r}},this.emit=async s=>{try{return await this.engine.emit(s)}catch(r){throw this.logger.error(r.message),r}},this.disconnect=async s=>{try{return await this.engine.disconnect(s)}catch(r){throw this.logger.error(r.message),r}},this.find=s=>{try{return this.engine.find(s)}catch(r){throw this.logger.error(r.message),r}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(s){throw this.logger.error(s.message),s}},this.name=(e==null?void 0:e.name)||Ii.name,this.metadata=(e==null?void 0:e.metadata)||Pn();const t=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:k.pino(k.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||Ii.logger}));this.core=(e==null?void 0:e.core)||new Dd(e),this.logger=k.generateChildLogger(t,this.name),this.session=new Ad(this.core,this.logger),this.proposal=new Rd(this.core,this.logger),this.pendingRequest=new Td(this.core,this.logger),this.engine=new Od(this)}static async init(e){const t=new ts(e);return await t.initialize(),t}get context(){return k.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}}const rr=[{name:"Rainbow",chains:[at.EIP155],logo:"https://images.web3auth.io/login-rainbow.svg",mobile:{native:"rainbow:",universal:"https://rnbwapp.com"},desktop:{native:"",universal:""}},{name:"MetaMask",chains:[at.EIP155],logo:"https://images.web3auth.io/login-metamask.svg",mobile:{native:"metamask:",universal:"https://metamask.app.link"},desktop:{native:"",universal:""}},{name:"Argent",chains:[at.EIP155],logo:"https://images.web3auth.io/login-argent.svg",mobile:{native:"argent://",universal:"https://www.argent.xyz/app"},desktop:{native:"",universal:""}},{name:"Trust Wallet",chains:[at.EIP155],logo:"https://images.web3auth.io/login-trust.svg",mobile:{native:"trust:",universal:"https://link.trustwallet.com"},desktop:{native:"",universal:""}},{name:"Zerion",chains:[at.EIP155],logo:"https://images.web3auth.io/login-zerion.svg",mobile:{native:"zerion://",universal:"https://wallet.zerion.io"},desktop:{native:"",universal:""}}];let Nd=function(i){return i.ETH_SEND_TRANSACTION="eth_sendTransaction",i.ETH_SIGN="eth_sign",i.PERSONAL_SIGN="personal_sign",i.ETH_SIGN_TYPED_DATA="eth_signTypedData",i}({}),$d=function(i){return i.ETH_CHAIN_CHANGED="chainChanged",i.ETH_ACCOUNTS_CHANGED="accountsChanged",i}({});const Ld=i=>{const{document:e}=i,t=e.querySelector('head > meta[property="og:site_name"]');if(t)return t.content;const s=e.querySelector('head > meta[name="title"]');return s?s.content:e.title&&e.title.length>0?e.title:i.location.hostname};function nr(i){return new Promise((e,t)=>{try{const s=document.createElement("img");s.onload=()=>e(!0),s.onerror=()=>e(!1),s.src=i}catch(s){t(s)}})}async function Md(i){const{document:e}=i;let t=e.querySelector('head > link[rel="shortcut icon"]');return t&&await nr(t.href)||(t=Array.from(e.querySelectorAll('head > link[rel="icon"]')).find(s=>!!s.href)||null,t&&await nr(t.href))?t.href:null}const jd=async()=>({name:Ld(window),icon:await Md(window)}),zd=i=>{const e=[];return i.forEach(t=>{const[s]=t.split(":");e.includes(s)||e.push(s)}),e},qd=i=>{switch(i){case at.EIP155:return Object.values(Nd);default:throw new Error(`No default methods for namespace: ${i}`)}},Ud=i=>{switch(i){case at.EIP155:return Object.values($d);default:throw new Error(`No default events for namespace: ${i}`)}},Fd=i=>{const e=zd(i);return Object.fromEntries(e.map(t=>[t,{methods:qd(t),chains:i.filter(s=>s.startsWith(t)),events:Ud(t)}]))},kd=async(i,e,t)=>{if(i===at.EIP155){const s=await jd(),r={walletConnectInitOptions:{projectId:t,relayUrl:"wss://relay.walletconnect.com",metadata:{name:s.name,description:s.name,url:window.location.origin,icons:[s.icon||""]}}},n=e.map(u=>`${i}:${u}`),a={optionalNamespaces:Fd(n)};return{adapterSettings:r,loginSettings:a}}throw new Error(`Unsupported chain namespace: ${i}`)},or=(i,e,t)=>{var s,r;const n=(t==null?void 0:t.requiredNamespaces)||{},a=`${i}:${e}`;return!n[i].chains||((s=n[i].chains)===null||s===void 0?void 0:s.length)===0?!1:!!((r=n[i].chains)===null||r===void 0?void 0:r.includes(a))};class sp extends Jn{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(e),Qe(this,"name",Ot.WALLET_CONNECT_V2),Qe(this,"adapterNamespace",Kn.EIP155),Qe(this,"currentChainNamespace",at.EIP155),Qe(this,"type",Hn.EXTERNAL),Qe(this,"adapterOptions",void 0),Qe(this,"status",Fe.NOT_READY),Qe(this,"adapterData",{uri:"",extensionAdapters:rr}),Qe(this,"connector",null),Qe(this,"activeSession",null),Qe(this,"wcProvider",null),this.adapterOptions=di({},e)}get connected(){return!!this.activeSession}get provider(){return this.status!==Fe.NOT_READY&&this.wcProvider?this.wcProvider:null}set provider(e){throw new Error("Not implemented")}async init(e){var t,s,r;await super.init(),super.checkInitializationRequirements();const n=(t=this.adapterOptions.adapterSettings)===null||t===void 0||(t=t.walletConnectInitOptions)===null||t===void 0?void 0:t.projectId;if(!n)throw tt.invalidParams("Wallet connect project id is required in wallet connect v2 adapter");const a=await kd((s=this.chainConfig)===null||s===void 0?void 0:s.chainNamespace,[parseInt((r=this.chainConfig)===null||r===void 0?void 0:r.chainId,16)],n);this.adapterOptions.loginSettings||(this.adapterOptions.loginSettings=a.loginSettings),this.adapterOptions.adapterSettings=Gn(a.adapterSettings,this.adapterOptions.adapterSettings);const{adapterSettings:u}=this.adapterOptions;if(this.connector=await ts.init(u==null?void 0:u.walletConnectInitOptions),this.wcProvider=new us({config:{chainConfig:this.chainConfig},connector:this.connector}),this.emit(ut.READY,Ot.WALLET_CONNECT_V2),this.status=Fe.READY,He.debug("initializing wallet connect v2 adapter"),e.autoConnect)if(await this.checkForPersistedSession(),this.connected){this.rehydrated=!0;try{await this.onConnectHandler()}catch(l){He.error("wallet auto connect",l),this.emit(ut.ERRORED,l)}}else this.status=Fe.NOT_READY,this.emit(ut.CACHE_CLEAR)}async connect(){if(super.checkConnectionRequirements(),!this.connector)throw tt.notReady("Wallet adapter is not ready yet");try{return this.connected?(await this.onConnectHandler(),this.provider):(this.status!==Fe.CONNECTING&&await this.createNewSession(),this.provider)}catch(e){throw He.error("Wallet connect v2 adapter error while connecting",e),this.status=Fe.READY,this.rehydrated=!0,this.emit(ut.ERRORED,e),e instanceof Wn?e:pi.connectionError(`Failed to login with wallet connect: ${(e==null?void 0:e.message)||""}`)}}async addChain(e){var t;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(super.checkAddChainRequirements(e,s),!or(this.currentChainNamespace,parseInt(e.chainId,16),this.adapterOptions.loginSettings))throw ls.chainIDNotAllowed(`Unsupported chainID: ${e.chainId}`);await((t=this.wcProvider)===null||t===void 0?void 0:t.addChain(e)),this.addChainConfig(e)}async switchChain(e){var t;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(super.checkSwitchChainRequirements(e,s),!or(this.currentChainNamespace,parseInt(e.chainId,16),this.adapterOptions.loginSettings))throw ls.chainIDNotAllowed(`Unsupported chainID: ${e.chainId}`);await((t=this.wcProvider)===null||t===void 0?void 0:t.switchChain({chainId:e.chainId})),this.setAdapterSettings({chainConfig:this.getChainConfig(e.chainId)})}async getUserInfo(){if(!this.connected)throw pi.notConnectedError("Not connected with wallet, Please login/connect first");return{}}async disconnect(){var e,t;let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{cleanup:!1};await super.disconnectSession();const{cleanup:r}=s;if(!this.connector||!this.connected||!((e=this.activeSession)!==null&&e!==void 0&&e.topic))throw pi.notConnectedError("Not connected with wallet");await this.connector.disconnect({topic:(t=this.activeSession)===null||t===void 0?void 0:t.topic,reason:Re("USER_DISCONNECTED")}),this.rehydrated=!1,r?(this.connector=null,this.status=Fe.NOT_READY,this.wcProvider=null):this.status=Fe.READY,this.activeSession=null,await super.disconnect()}cleanupPendingPairings(){if(!this.connector)throw tt.notReady("Wallet adapter is not ready yet");const e=this.connector.pairing.getAll({active:!1});gr(e)&&e.forEach(t=>{this.connector&&this.connector.pairing.delete(t.topic,Re("USER_DISCONNECTED"))})}async checkForPersistedSession(){if(!this.connector)throw tt.notReady("Wallet adapter is not ready yet");if(this.connector.session.length){const e=this.connector.session.keys.length-1;this.activeSession=this.connector.session.get(this.connector.session.keys[e])}return this.activeSession}async createNewSession(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{forceNewSession:!1};try{var t,s;if(!this.connector)throw tt.notReady("Wallet adapter is not ready yet");if(!this.adapterOptions.loginSettings)throw tt.notReady("login settings are not set yet");if(this.status=Fe.CONNECTING,this.emit(ut.CONNECTING,{adapter:Ot.WALLET_CONNECT_V2}),e.forceNewSession&&(t=this.activeSession)!==null&&t!==void 0&&t.topic){var r;await this.connector.disconnect({topic:(r=this.activeSession)===null||r===void 0?void 0:r.topic,reason:Re("USER_DISCONNECTED")})}He.debug("creating new session for web3auth wallet connect");const{uri:a,approval:u}=await this.connector.connect(this.adapterOptions.loginSettings),l=(s=this.adapterOptions)===null||s===void 0||(s=s.adapterSettings)===null||s===void 0?void 0:s.qrcodeModal;if(a)if(l)try{await l.openModal({uri:a}),He.debug("EVENT","QR Code Modal closed"),this.status=Fe.READY,this.emit(ut.READY,Ot.WALLET_CONNECT_V2)}catch{He.error("unable to open qr code modal")}else this.updateAdapterData({uri:a,extensionAdapters:rr});He.info("awaiting session approval from wallet");const c=await u();this.activeSession=c,await this.onConnectHandler(),l&&l.closeModal()}catch(a){var n;if((n=a.message)!==null&&n!==void 0&&n.toLowerCase().includes("proposal expired")){if(He.info("current adapter status: ",this.status),this.status===Fe.CONNECTING)return He.info("retrying to create new wallet connect session since proposal expired"),this.createNewSession({forceNewSession:!0});if(this.status===Fe.READY){He.info("ignoring proposal expired error since some other adapter is connected");return}}throw He.error("error while creating new wallet connect session",a),this.emit(ut.ERRORED,a),a}}async onConnectHandler(){var e;if(!this.connector||!this.wcProvider)throw tt.notReady("Wallet adapter is not ready yet");if(!this.chainConfig)throw tt.invalidParams("Chain config is not set");(e=this.adapterOptions.adapterSettings)!==null&&e!==void 0&&e.qrcodeModal&&(this.wcProvider=new us({config:{chainConfig:this.chainConfig,skipLookupNetwork:!0},connector:this.connector})),await this.wcProvider.setupProvider(this.connector),this.subscribeEvents(),this.cleanupPendingPairings(),this.status=Fe.CONNECTED,this.emit(ut.CONNECTED,{adapter:Ot.WALLET_CONNECT_V2,reconnected:this.rehydrated})}subscribeEvents(){if(!this.connector)throw tt.notReady("Wallet adapter is not ready yet");this.connector.events.on("session_update",e=>{let{topic:t,params:s}=e;if(!this.connector)return;const{namespaces:r}=s,n=this.connector.session.get(t),a=di(di({},n),{},{namespaces:r});this.activeSession=a}),this.connector.events.on("session_delete",()=>{this.disconnect()})}}export{Nd as DEFAULT_EIP155_METHODS,$d as DEFAULT_EIP_155_EVENTS,rr as WALLET_CONNECT_EXTENSION_ADAPTERS,sp as WalletConnectV2Adapter,zd as getNamespacesFromChains,Fd as getRequiredNamespaces,Ud as getSupportedEventsByNamespace,qd as getSupportedMethodsByNamespace,kd as getWalletConnectV2Settings};
